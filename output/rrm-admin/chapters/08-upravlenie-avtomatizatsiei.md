## 8 Управление автоматизацией

В РОСА Менеджер ресурсов поставщик управления автоматизацией — это инструмент управления, который интегрируется с Комплексом для упрощения операций автоматизации для ресурсов инфраструктуры.

### 8.1 Автоматизация

Комплекс обеспечивает управление автоматизацией с помощью типов поставщиков:

Ansible Tower – это инструмент управления, интегрированный с РОСА Менеджер ресурсов, предназначенный для автоматизации операций инфраструктуры корпоративного уровня с использованием существующих поставщиков Ansible Tower. Комплекс позволяет выполнять задания Ansible Tower с помощью каталогов служб и автоматизации. Используя Ansible Tower, можно планировать запуски сценариев Ansible и отслеживать текущие и исторические результаты, что позволяет устранять неполадки или выявлять проблемы до их возникновения.

#### 8.1.1 Поставщики

Для создания нового поставщика автоматизации необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация → Автоматизация → Поставщики"; в рабочей области появится список существующих автоматизаций с описанием;

нажать кнопку Конфигурация, затем – Добавить нового поставщика (рисунок 115);

в рабочей области "Добавление нового поставщика автоматизации" задать параметры:

"Тип" – выбрать из раскрывающегося списка тип автоматизации "Ansible Tower Automation";

"Имя" – ввести имя поставщика;

"Зона" – выбрать зону;

"Конечная точка" – ввести URL, выбрать способ верификации SSL, задать "Имя пользователя" и "Пароль";

нажать кнопку Проверить действительность для подтверждения корректности введенных параметров;

нажать кнопку Добавить в случае успешного подтверждения.

Добавление нового поставщика автоматизации

Для работы с существующими поставщиками следует выбрать нужных поставщиков, нажать кнопку Конфигурация и выбрать одну из опций в появившемся меню:

Обновить сведения об отношениях и состоянии электропитания – обновить сведения для всех элементов, связанных с выбранными поставщиками;

Редактировать выбранного поставщика – внести необходимые изменения в параметры поставщика;

Удалить выбранные элементы из инвентаря – удалить выбранные флажками из списка поставщиков, подтвердив удаление нажатием кнопки Да в появившемся модальном окне.

### 8.2 Конфигурация

#### 8.2.1 Поставщики

Поставщик управления конфигурацией – это программный продукт, который можно добавить к Комплексе для управления жизненным циклом ресурсов. Поставщики управления конфигурацией полезны для единообразного применения изменений и обновлений между поставщиками, а также для записи и отчетности о состоянии и активности изменений. Они также могут помочь устранить путаницу и ошибки, вызванные существованием разных поставщиков.

Поставщиков управления конфигурацией необходимо добавлять в Комплекс индивидуально. В Комплексе доступны три типа поставщиков управления конфигурацией:

Foreman Configuration – это решение с открытым исходным кодом, которое обеспечивает управление ИТ-инфраструктурой на протяжении всего жизненного цикла – от развёртывания и конфигурации до мониторинга; позволяет автоматизировать любые повторяющиеся задачи, управлять изменениями на большом числе серверов и контролировать их статус;

РОСА Центр Управления – это платформа централизованного управления жизненным циклом гибридной ИТ-инфраструктуры корпоративного уровня, включающей инфраструктуру физической, виртуальной, облачной и контейнерной среды организации; позволяет осуществлять сетевое развертывание (установку ОС и настройку системной конфигурации) управляемых хостов (физических серверов и ВМ) в автоматическом режиме;

IBM Terraform Configuration – это программный продукт для управления состоянием ИТ-инфраструктуры; позволяет развернуть и настроить инфраструктуру с помощью кода, упростить администрирование облачными ресурсами.

Для создания нового поставщика конфигурации необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация → Конфигурация → Поставщики"; в рабочей области появится список существующих поставщиков конфигураций с описанием;

нажать кнопку Конфигурация, затем – Добавить нового поставщика;

в рабочей области "Добавление нового поставщика конфигурации" задать параметры (рисунок 116):

"Тип" – выбрать из раскрывающегося списка один типов автоматизации;

"Имя" – ввести имя поставщика;

"Зона" – выбрать зону;

в секции "Конечная точка" – ввести параметры подключения к поставщику конфигурации;

Примечание – Перечень параметров конечной точки изменяется в зависимости от выбранного типа поставщика.

нажать кнопку Проверить действительность для подтверждения корректности введенных параметров;

нажать кнопку Добавить в случае успешного подтверждения.

Добавление нового поставщика конфигурации

Для работы с существующими поставщиками следует выбрать нужных поставщиков, нажать кнопку Конфигурация и выбрать одну из опций в появившемся меню:

Обновить сведения об отношениях и состоянии электропитания – обновить сведения для всех элементов, связанных с выбранными поставщиками;

Редактировать выбранный элемент – внести необходимые изменения в параметры поставщика;

Удалить выбранные элементы из инвентаря – удалить выбранные флажками из списка поставщиков, подтвердив удаление нажатием кнопки Да в появившемся модальном окне.

### 8.3 Встроенный Ansible

Ansible – интеграция с этим модулем обеспечивает готовую поддержку для служб, предупреждений и действий политик с помощью наборов сценариев Ansible: синхронизация существующих репозиториев сценариев с Комплексом, добавление учетных данных для поставщиков доступа и создание элементов каталога служб для различных действий – создание и вывод из эксплуатации ВМ, обновление программного обеспечения безопасности или добавление дополнительных дисков при нехватке места.

#### 8.3.1 Учетные данные

Учетные данные используются Комплексом для аутентификации при запуске сценариев Ansible на компьютерах, синхронизации с источниками инвентаря и синхронизации существующих репозиториев сценариев с Комплексом.

Для просмотра сведений об учетных записях нужно выбрать из меню панели навигации "Автоматизация  Вcтроенный Ansible  Учетные данные"; в рабочей области появится список учетных данных с описанием, типом, пользователем, временем создания и обновления.

Для просмотра подробных сведение об учетной записи нужно нажать на ее имя; в рабочей области отобразятся сведения, расположенные по секциям: "Свойства", "Отношения" с репозиториями, "Параметры учетных данных", "Управление Smart" с назначенными тегами (рисунок 117).

Сведения об учетных данных

Для редактирования тегов учетных данных нужно нажать на кнопку Политики и выбрать "Редактировать теги"; в появившейся рабочей области выбрать из раскрывающихся списков "Категорию" и "Значение" тега, после чего они повятся в секции "Назначенные теги". Убрать тег из назначенных можно с помощью пиктограммы . Далее нажать кнопку Сохранить.

### 8.4 Встроенная автоматизация

Автоматизация обеспечивает двунаправленную интеграцию процессов в реальном времени. Это предоставляет пользователям метод реализации адаптивной автоматизации событий управления, а также административной или операционной деятельности.

Модель автоматизации организована таким образом, чтобы обеспечить объектно-ориентированную иерархию для управления функциями автоматизации. В модели используются следующие организационные единицы, расположенные в иерархической форме:

Хранилище данных — основная организационная единица, в которой хранится вся модель;

Домены – действуют как совокупность функций автоматизации. Функции выполняются в зависимости от порядка приоритета Домена, означающего, что функция в Домене с более высоким приоритетом переопределяет те же функции, указанные в Домене с более низким приоритетом. Это позволяет Комплексе указывать основной домен, но и предоставляет пользователям возможность переопределять функции автоматизации с помощью пользовательских доменов. Каждый домен содержит набор пространств имен;

Пространства имен – контейнеры, которые организуют и классифицируют функции модели автоматизации. Пространства имен могут содержать дочерние пространства имен, а также классы;

Классы – шаблоны для конкретной функции модели автоматизации. Каждый класс использует схему для применения к экземплярам для заполнения значениями по умолчанию. Каждый класс также может содержать набор методов;

Экземпляр – это версия класса, заполненная исходными данными конфигурации. Экземпляр может включать в себя коллекцию любого количества атрибутов, вызовов методов и отношений;

Методы – это функции внутри модели автоматизации. Методы используют код Ruby для выполнения различных операций, необходимых для класса.

#### 8.4.1 Хранилище данных

Для просмотра модели автоматизации нужно выбрать в меню панель навигации "Автоматизация  Встроенная автоматизация  Проводник"; в левой панели рабочей области отобразится "Хранилище данных" в иерархическом виде, в правой – сведения об элементах (рисунок 118).

Иерархия хранилища данных

Комплекс содержит предварительно настроенный домен для пользователей ManageIQ – основной домен для автоматизации операций Комплекса. Этот домен заблокирован следующими пространствами имен:

Cloud – общий жизненный цикл облачного экземпляра, начиная с подготовки, вывода из эксплуатации, методов и электронной почты;

Control – элемент управления содержит оповещения по электронной почте для политик контроля;

Infrastructure – жизненный цикл ВМ общей инфраструктуры, начиная с подготовки до вывода из эксплуатации, методов и электронной почты;

Integration – используется для взаимодействия с ПО за пределами Комплекса. Это пространство имен используют для интеграции с дополнительными сервисами;

Service – жизненный цикл службы, начиная с подготовки до вывода из эксплуатации, методов и электронной почты;

System – Комплекс содержит классы, которые могут служить отправной точкой для всех действий автоматизации Комплекса.

В Комплексе можно копировать классы и экземпляры из заблокированных доменов в свои собственные домены.

Примечание – Изменять существующие классы или экземпляры, поставляемые с Комплексом, не рекомендуется, поскольку это может помешать ее работе. Можно ссылаться на методы, используя отношения.

##### 0.0.0.1 Импорт/экспорт хранилища данных

Для импорта/экспорта данных хранилища между серверами разных Комплексов нужно выбрать в меню панели навигации "Автоматизация  Встроенная автоматизация  Импорт/Экспорт" (рисунок 119).

Для импорта классов хранилища данных из архивного файла формата ZIP нужно нажать кнопку Выберите файл, средствами ОС выбрать zip-файл, и нажать кнопку Отправить. В результате импортированные классы будут скопированы в Комплекс.

Для импорта хранилища данных с помощью Git необходимо:

ввести URL в поле "Git URL";

при необходимости ввести имя и пароль пользователя Git в соответствующие поля;

при необходимости поставить флажок, чтобы "Подтвердить сертификат однорангового узла";

нажать кнопку Отправить.

Примечание – Для импорта репозиториев Git следует активировать роль владельца Git.

Для экспорта всех классов и экземпляров в файл нужно нажать кнопку  в секции "Экспорт". Средствами браузера будет создан zip-файл с именем datastore_<yyyy>_<mm>_<dd>.zip.

Импорт/экспорт хранилища данных

##### 8.4.1.1 Журнал

В Комплексе ведется log-файл, в который журналируются все операции по автоматизации.

Для просмотра журнала нужно выбрать в панели навигации "Автоматизация  Встроенная автоматизация  Журнал" и в рабочей области отобразятся последние 1000 строк журнала автоматизации.

Для скачивания всего журнала автоматизации следует нажать пиктограмму  в панели быстрого доступа. Средствами браузера будет создан файл с именем automation.log.

#### 8.4.2 Домены

Для добавления нового домена необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Проводник"; в левой панели рабочей области выбрать "Хранилище данных"; в правой панели появится список доменов с описанием, отметкой о включении/отключении и арендатором;

нажать кнопку Конфигурация, затем –  Добавить новый домен;

в рабочей области "Добавление нового домена автоматизации" задать параметры в секции "Сведения" (рисунок 120):

"Имя" – наименование домена;

"Описание" – краткое описание домена;

"Включено" – поставить флажок, если домен включен, иначе – отключен;

нажать кнопку Добавить.

Добавление нового домена

Для работы с уже существующими доменами при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать приоритетный порядок доменов – изменить приоритет работы доменов, используя кнопки  и  (рисунок 121);

Редактирование приоритетного порядка доменов

Редактировать этот (выбранный) домен – внести необходимые изменения в параметры домена;

Удалить (этот) домен(-ы) – удалить выбранные из списка домен(-ы), подтвердив действие нажатием кнопки Да в появившемся модальном окне;

Заблокировать этот домен – заблокировать домен, исключая при этом перенос его кода; при этом рядом с именем домена появится отметка "(Заблокировано)";

Добавить новое пространство имен – добавить новое пространство имен в домене (см. п.8.4.3).

#### 8.4.3 Пространство имен

Для добавления нового пространства имен необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Проводник"; в левой панели рабочей области выбрать домен или одно из пространства имен в иерархическом списке в левой панели; в правой панели появится список пространств имен или классов соответственно;

нажать кнопку Конфигурация, затем – Добавить новое пространство имен;

в рабочей области "Добавление нового пространства имен автоматизации" в секции "Сведения" появится значение "Полное имя (FQN)" пространства имен, и нужно задать параметры (рисунок 122):

"Имя" – наименование пространства имен;

"Описание" – краткое пространства имен;

нажать кнопку Добавить.

Добавление нового пространства имен

Для работы с уже существующими пространствами имен при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать это пространство имен – внести необходимые изменения в параметры пространства имен;

Удалить это пространство имен – удалить выбранные из списка пространства имен, подтвердив действие нажатием кнопки Да в появившемся модальном окне;

Добавить новое пространство имен – добавить новое дочернее пространство имен по отношению к выбранному в домене; действия по добавлению аналогичны приведенным в этом пункте;

Добавить новый класс – добавить новый класс в пространство имен (см. п.8.4.4).

#### 8.4.4 Классы

Для добавления нового класса необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Проводник"; в левой панели рабочей области выбрать пространство имен в иерархическом списке; в правой панели появится список дочерних пространств имен и классов;

нажать кнопку Конфигурация, затем –  Добавить новый класс;

в рабочей области "Добавление нового класса автоматизации" в секции "Свойства" появится значение "Полное имя (FQN)" пространства имен, и нужно задать параметры (рисунок 123):

"Имя" – наименование класса;

"Показываемое имя" – наименование класса, которое будет показываться рядом с именем класса в круглых скобках;

"Описание" – краткое описание класса;

нажать кнопку Добавить.

Добавление нового класса

Для работы с уже существующими классами при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать этот класс – внести необходимые изменения в параметры пространства имен;

Копировать этот класс – копировать один или несколько выбранных классов, задав уникальное "Новое имя" и (рисунок 124):

поставить флажок в опцию "Копировать в тот же путь" для копирования в то же пространство имен;

убрать флажок в опцию "Копировать в тот же путь"; в поле "Пространство имен" ввести или выбрать по нажатию пиктограммы  во всплывающем модальном окне "Выбрать точку входа пространства имен" пространство имен для копирования (очистить выбранный список можно пиктограммой ); при необходимости поставить флажок в опцию "Включить в путь префикс домена" для указания полного пути копирования; нажать кнопку Применить;

Копирование классов

Удалить этот класс – удалить выбранный класс из списка классов, подтвердив действие нажатием кнопки Да в появившемся модальном окне;

Добавить новый экземпляр – добавить новый экземпляр класса (см. п.8.4.5).

#### 8.4.5 Экземпляры

Для добавления нового экземпляра класса необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Проводник"; в левой панели рабочей области выбрать класс в иерархическом списке; в правой панели появится список экземпляров выбранного класса;

нажать кнопку Конфигурация, затем –  Добавить новый экземпляр;

в рабочей области "Добавление нового экземпляра автоматизации" во вкладке "Экземпляры" появится значение "Полное имя (FQN)" класса; нужно задать параметры (рисунок 125):

"Имя" – наименование экземпляра;

"Показываемое имя" – наименование экземпляра, которое будет показываться рядом с именем класса в круглых скобках;

"Описание" – краткое описание экземпляра;

нажать кнопку Добавить.

Добавление нового экземпляра

Во вкладке "Свойства" можно посмотреть свойства выбранного экземпляра.

Для работы с уже существующими экземплярами класса при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать этот экземпляр – внести необходимые изменения в параметры экземпляра;

Копировать выбранные (этот) экземпляр(-ы) – копировать один или несколько выбранных экземпляров, задав уникальное "Новое имя", и (рисунок 126):

поставить флажок в опцию "Копировать в тот же путь" для копирования в то же пространство имен;

убрать флажок в опцию "Копировать в тот же путь"; в поле "Пространство имен" ввести или выбрать по нажатию пиктограммы  во всплывающем модальном окне "Выбрать точку входа пространства имен" пространство имен для копирования (очистить выбранный список можно пиктограммой ); при необходимости поставить флажок в опцию "Включить в путь префикс домена" для указания полного пути копирования; нажать кнопку Применить;

поставить флажок в опцию "Заменить элементы если они уже существуют?" для перезаписи элементов с такими же именами;

Копирование экземпляров

Удалить этот экземпляр – удалить выбранный экземпляр из класса, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

#### 8.4.6 Методы

Для добавления нового метода класса необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Проводник"; в левой панели рабочей области выбрать класс в иерархическом списке; в правой панели появится список экземпляров выбранного класса;

перейти на вкладку "Методы";

нажать кнопку Конфигурация, затем –  Добавить новый метод;

в рабочей области "Добавление нового метода автоматизации" в секции "Основные сведения" выбрать из раскрывающегося списка "Тип" метода (рисунок 127);

задать параметры метода, состав которых зависит от выбранного типа (см. п.8.4.6.1);

нажать кнопку Добавить.

Добавление нового метода

Для работы с уже существующими методами класса при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать этот метод – внести необходимые изменения в параметры метода;

Копировать этот метод – копировать метод, задав уникальное "Новое имя" (рисунок 128):

поставить флажок в опцию "Копировать в тот же путь" для копирования в то же пространство имен;

убрать флажок в опцию "Копировать в тот же путь"; в поле "Пространство имен" ввести или выбрать по нажатию пиктограммы  во всплывающем модальном окне "Выбрать точку входа пространства имен" пространство имен для копирования (очистить выбранный список можно пиктограммой ); при необходимости поставить флажок в опцию "Включить в путь префикс домена" для указания полного пути копирования; нажать кнопку Применить;

поставить флажок в опцию "Заменить элементы если они уже существуют?" для перезаписи элементов с такими же именами;

Копирование методов

Удалить этот экземпляр – удалить выбранный метод из класса, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

##### 0.0.0.1 Описание типов методов

Состав параметров при добавлении или редактировании метода, описанных в п.8.4.6, зависит от выбранного типа.

В этом пункте приведен перечень типов, описание их параметров и действия с ними при редактировании:

Шаблон задачи Ansible Tower:

"Имя" – ввести имя метода;

"Показываемое имя" – ввести показываемое в интерфейсе имя метода;

"Поставщик" – выбрать из раскрывающегося списка тип поставщика;

"Шаблон задачи" – выбрать из раскрывающегося списка шаблон задачи;

"Хосты" – выбрать из раскрывающегося списка "Локальный хост" или "Указать значение хоста", при этом ввести значение в появившемся поле;

"Макс. время жизни (минут)" – ввести максимальное время жизни в минутах;

"Вывод журналирования" – выбрать тип вывода в журнал: "При ошибке", "Всегда" или "Никогда";

"Параметры ввода" – вести имя параметра, выбрать тип данных и задать значение по умолчанию; нажать пиктограмму  для добавления в метод (строка появится в таблице ниже; для редактирования или удаления параметра можно воспользоваться пиктограммами  или  соответственно в строке таблицы параметров;

Шаблон потока процедур Ansible Tower:

"Имя" – ввести имя метода;

"Показываемое имя" – ввести показываемое в интерфейсе имя метода;

"Поставщик" – выбрать из раскрывающегося списка тип поставщика;

"Шаблон потока процедур" – выбрать из раскрывающегося списка шаблон потока процедур;

"Макс. время жизни (минут)" – ввести максимальное время жизни в минутах;

"Вывод журналирования" – выбрать тип вывода в журнал: "При ошибке", "Всегда" или "Никогда";

"Параметры ввода" – вести имя параметра, выбрать тип данных и задать значение по умолчанию; нажать пиктограмму  для добавления в метод (строка появится в таблице ниже; для редактирования или удаления параметра можно воспользоваться пиктограммами  или  соответственно в строке таблицы параметров;

Встроенное:

"Имя" – ввести имя метода;

"Показываемое имя" – ввести показываемое в интерфейсе имя метода;

"Встроенное имя" – ввести дополнительное имя (если не указано, то используется имя метода);

"Параметры ввода" – нажать пиктограмму ; вести имя параметра, выбрать тип данных и задать значение по умолчанию; нажать пиктограмму  для добавления в метод в виде отдельной строки (для удаления поля можно воспользоваться пиктограммой  в строке параметра);

Выражение:

"Имя" – ввести имя метода;

"Показываемое имя" – ввести показываемое в интерфейсе имя метода;

"Объект выражения" – выбрать из раскрывающегося списка объект, к которому будет относиться выражение;

"Редактировать выражение" – построить логическое выражение (см. п.3.2), относящееся к объекту выражения;

"Параметры ввода" – нажать пиктограмму ; вести имя параметра, выбрать тип данных и задать значение по умолчанию; нажать пиктограмму  для добавления в метод в виде отдельной строки (для удаления поля можно воспользоваться пиктограммой  в строке параметра);

Встроенный:

"Имя" – ввести имя метода;

"Показываемое имя" – ввести показываемое в интерфейсе имя метода;

"Объект выражения" – выбрать из раскрывающегося списка объект, к которому будет относиться выражение;

"Встроенные методы" – нажать кнопку Добавить метод; при необходимости поставить переключатель "Включить в путь префикс домена:" в положение "ON" для встраивания с полным путем; в появившемся модальном окне выбрать созданный ранее метод для подключения в качестве встроенного; окно автоматически закроется и полный путь появится в рабочей области (для удаления можно нажать кнопку Удалить;

"Данные" – ввести в поле ввода описание метода на языке Ruby; нажать кнопку Проверить действительность для подтверждения корректности введенного кода;

"Параметры ввода" – нажать пиктограмму ; вести имя параметра, выбрать тип данных и задать значение по умолчанию; нажать пиктограмму  для добавления в метод в виде отдельной строки (для удаления поля можно воспользоваться пиктограммой  в строке параметра);

Набор сценариев:

"Имя" – ввести имя метода;

"Показываемое имя" – ввести показываемое в интерфейсе имя метода;

"Репозиторий" – выбрать из раскрывающегося списка репозиторий исходных кодов;

"Хосты" – выбрать "Локальный хост" или "Указать значение хоста", при этом ввести значение в появившемся поле;

"Макс. время жизни (минут)" – ввести максимальное время жизни в минутах;

"Вывод журналирования" – выбрать тип вывода в журнал: "При ошибке", "Всегда" или "Никогда";

"Уровень детализации" – при необходимости выбрать из раскрывающегося списка один из уровней детализации "0(Normal) (Нормальный)", "1(Verbose) (Подробный)", "2(More Verbose) (Более подробный)", "3(Debug) (Отладка)", "4(Connection Debug) (Отладка соединения)", "5(WinRM Debug) (Отладка удаленного управления Windows)" ;

"Параметры ввода" – вести имя параметра, выбрать тип данных и задать значение по умолчанию; нажать пиктограмму  для добавления в метод (строка появится в таблице ниже; для редактирования или удаления параметра можно воспользоваться пиктограммами  или  соответственно в строке таблицы параметров.

#### 8.4.7 Редактирование схемы класса

Для редактирования схемы класса необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Проводник"; в левой панели рабочей области выбрать класс в иерархическом списке; в правой панели появится вкладка "Экземпляры" и список экземпляров выбранного класса;

перейти на вкладку "Схема";

нажать кнопку Конфигурация, затем – Редактировать выбранную схему;

в рабочей области выбранного класса в секции "Схема" нажать на пиктограмму  в первом столбце списка для добавления нового поля (для удаления поля используется пиктограмма );

задать значения параметров поля (рисунок 129):

"Имя" – имя поля;

"Тип": "Assertion (Утверждение)", "Attribute (Атрибут)", "Method (Метод)", "Relationship (Отношение)", "State (Состояние)";

"Тип данных";

"Значение по умолчанию"

"Показываемое имя";

"Описание";

"Подчиненные элементы" – поставить флажок, если у поля есть дочерние элементы;

"Собрать";

"Сообщение";

"При входе";

"При выходе";

"При ошибке";

"Макс.повторных ошибок";

"Макс.время".

нажать кнопку Сохранить.

Редактирование схемы класса

#### 8.4.8 Редактирование последовательности схемы класса

Для редактирования последовательности схемы класса необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Проводник"; в левой панели рабочей области выбрать класс в иерархическом списке; в правой панели появится вкладка "Экземпляры" и список экземпляров выбранного класса;

перейти на вкладку "Схема";

нажать кнопку Конфигурация, затем – Редактировать последовательность;

в рабочей области выбранного класса в списке "Последовательность схемы класса" задать порядок, используя кнопки  и  для перемещения выше или ниже по списку (рисунок 130);

Примечание – Для перемещения нескольких полей используют для их выбора вместе с кнопкой "мыши" клавишу Ctrl .

Редактирование последовательности схемы класса

нажать кнопку Сохранить.

#### 8.4.9 Имитация

Для предварительной проверки модулей, процессов, параметров автоматизации с привязкой к объектам перед эксплуатацией в инфраструктуре рекомендуется воспользоваться функцией имитации в Комплексе.

В меню панели навигации нужно выбрать "Автоматизация  Встроенная автоматизация  Имитация". В левой панели появившейся рабочей области задают параметры автоматизации, в правой отражаются результаты имитационных действий (рисунок 131).

Для задания параметров имитации нужно ввести или выбрать значения в поля:

"Система/процесс" – выбрать действие;

"Сообщение" – ввести текст сообщения к действию;

"Запрос" – ввести выражение запроса;

"Тип" – выбрать из раскрывающегося списка тип объекта и из контекстно-зависимого появившегося списка выбрать непосредственно объект;

"Методы выполнения" – пометить флажком применение метода выполнения в параметрах имитации;

"атрибуты/значения" – задать пары атрибутов и их значений.

Для имитации следует нажать кнопку Отправить.

В случае выполнения имитации без ошибок в правой панели рабочей области отобразятся результаты в трех вкладках:

"Древесное представление" – обзор результирующих данных в иерархическом преставлении;

"Представление XML" – обзор результирующих данных в виде XML;

"Объект" – описание объекта автоматизации.

Имитация

Примечание – C помощью кнопки Копировать в панели быстрого доступа можно скопировать подробности об объекте для использования в кнопке.

#### 8.4.10 Общие объекты

Встроенная автоматизация в РОСА Менеджер ресурсов позволяет создавать классы общих объектов.

Для создания класса общих объектов необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Общие объекты"; в левой панели рабочей области выбрать аккордеон "Определения общих объектов" и каталог "Все определения общих объектов" в иерархическом списке; в правой панели появится список общих объектов с писанием, датой создания, датой обновления, количеством вложенных экземпляров;

нажать кнопку Конфигурация, затем – Добавить новое определение класса общих объектов;

в рабочей области "Добавление нового определения класса общих объектов" задать параметры в соответствующих секциях (рисунок 132):

"Имя" – наименование определения;

"Описание" – краткое описание определения;

"Атрибуты" – нажать клавишу  для добавления нового атрибута; в появившихся полях ввести "Имя" и выбрать "Тип" данных атрибута; для удаления атрибута можно нажать клавишу ;

"Связи" – нажать клавишу  для добавления новой связи; в появившихся полях ввести "Имя" и выбрать "Класс" связи; для удаления связи можно нажать клавишу ;

"Метод" – нажать клавишу  для добавления нового метода; в появившемся поле ввести "Имя" метода; для удаления метода можно нажать клавишу ;

"Файл настраиваемого изображения" – встроенными средствами ОС выбрать файл;

нажать кнопку Добавить.

Добавление нового определения класса общих объектов

Для работы с уже существующими определениями общих объектов при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать выбранное определение общего объекта – внести необходимые изменения в параметры определения общих объектов;

Удалить выбранные определения общих объектов из инвентаря – удалить выбранные определения из списка, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

##### 0.0.0.1 Группы кнопок

Для общих объектов можно создавать кнопки и группы кнопок для запуска сценариев, привязанных к определениям.

Для создания новой группы настраиваемых кнопок необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Общие объекты"; в левой панели рабочей области выбрать аккордеон "Определения общих объектов", каталог "Все определения общих объектов" в иерархическом списке; в правой панели появится список определений общих объектов;

нажать кнопку Конфигурация, затем – Добавить новую группу кнопок;

в рабочей области "Добавление новой группы настраиваемых кнопок" задать параметры (рисунок 133):

"Имя" – наименование группы;

поставить флажок "Показать на кнопке", чтобы имя группы показывалось в каталоге определений;

"Описание" – краткое описание группы;

"Значок" – выбрать изображение для значка группы из коллекции Комплекса, нажав кнопку Применить;

"Цвет значка" – задать цвет значка из предложенной палитры цветов;

"Назначить кнопки" – выбрать параметры фильтров из списка "Не назначен" в список "Выбрано" для назначения этой группе кнопок, используя кнопки Добавить, Добавить все, Удалить, Удалить все;

нажать кнопку Добавить.

Для работы с уже существующими группами кнопок при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать эту группу кнопок – внести необходимые изменения в параметры группы кнопок;

Удалить эту группу кнопок из инвентаря – удалить выбранную из списка группу кнопок, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

Добавление новой группы кнопок

##### 8.4.10.1 Кнопки

Для создания новой настраиваемой кнопки необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Общие объекты"; в левой панели рабочей области выбрать аккордеон "Определения общих объектов", каталог "Все определения общих объектов" и определение общих объектов или группу кнопок в иерархическом списке; в правой панели появится список определений общих объектов;

нажать кнопку Конфигурация, затем – Добавить новую кнопку;

в рабочей области "Добавление новой настраиваемой кнопки" задать параметры:

"Тип кнопки" – выбрать из списка тип кнопки: "Default" или "Ansible Playbook"; перечень задаваемых параметров зависит от типа выбранной кнопки:

при выборе "Default" (рисунок 134):

"Имя" – наименование кнопки;

поставить флажок "Показать на кнопке", чтобы имя кнопки показывалось в каталоге определений;

"Описание" – краткое описание кнопки;

"Значок" – выбрать изображение для значка кнопки из коллекции Комплекса, нажав кнопку Применить;

"Цвет значка" – задать цвет значка из предложенной палитры цветов;

"Диалог" – выбрать назначенный этой кнопке диалог из каталога служб;

"Показать для" – выбрать какой перечень объектов будет показываться для этой кнопки;

"Отправить" – выбрать способ отправки "Оправить все" или "Один за другим";

"Система/Процесс" – выбрать назначенное этой кнопке действие из списка модулей или процессов Комплекса;

"Сообщение" – ввести сообщение, выводимое для кнопки;

"Запрос" – ввести выражение для запроса;

"Доступ роли" – выбрать доступ к кнопке <Всем> или <По роли>, выбрав флажками из появившегося списка роли, которым предоставлен доступ к использованию кнопки.

Добавление кнопки типа "Default"

при выборе "Ansible Playbook" (рисунок 135):

"Элемент каталога наборов сценариев" – выбрать из раскрывающегося списка один из элементов, назначенный кнопке;

"Инвентарь" – выбрать один из типов инвентаря: "Локальный хост", "Целевая машина" или "Конкретные хосты"; при выборе "Конкретные хосты" нужно ввести в появившееся поле "Введите список имён DNS или IP через запятую" данные о требуемых хостах;

"Имя" – ввести наименование кнопки;

поставить флажок "Показать на кнопке", чтобы имя кнопки показывалось в каталоге определений;

"Описание" – краткое описание кнопки;

"Значок" – выбрать изображение для значка кнопки из коллекции Комплекса, нажав кнопку Применить;

"Цвет значка" – задать цвет значка из предложенной палитры цветов;

"Диалог" – выбрать назначенный этой кнопке диалог из каталога служб;

"Показать для" – выбрать какой перечень объектов будет показываться для этой кнопки;

"Отправить" – выбрать способ отправки "Оправить все" или "Один за другим";

"Система/Процесс" – выбрать назначенное этой кнопке действие из списка модулей или процессов Комплекса;

"Сообщение" – ввести сообщение, выводимое для кнопки;

"Запрос" – ввести выражение для запроса;

"Доступ роли" – выбрать доступ к кнопке <Всем> или <По роли>, выбрав флажками из появившегося списка роли, которым предоставлен доступ к использованию кнопки.

Добавление кнопки типа "Ansible Playbook"

Для работы с уже существующими кнопками при нажатии Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать эту кнопку – внести необходимые изменения в параметры кнопки;

Удалить эту кнопку из инвентаря – удалить выбранную из списка кнопку, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

#### 8.4.11 Настройка

Для доступа к настройкам модели автоматизации нужно выбрать в меню панель навигации "Автоматизация  Встроенная автоматизация  Настройки"; в левой панели рабочей области отображаются аккордеоны "Диалоги подготовки ресурсов", "Диалоги служб", "Кнопки", "Импорт/экспорт" со вложенными каталогами в иерархическом виде, в правой – сведения об элементах каталогов (рисунок 136).

Настройка встроенной автоматизации

##### 0.0.0.1 Диалоги подготовки ресурсов

В Комплексе могут быть использованы встроенные диалоги подготовки ресурсов, на основе которых могут быть созданы собственных диалоги, или разработаны пользовательские диалоги. При этом встроенные диалоги невозможно редактировать или удалить.

Для добавления нового диалога необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Настройка"; в левой панели рабочей области выбрать нужный каталог с диалогами в иерархическом списке; в правой панели появится список диалогов выбранного каталога;

нажать кнопку Конфигурация, затем –  Добавить новый диалог;

в рабочей области "Добавление нового диалога" нужно задать параметры: (рисунок 137):

в секции "Основные сведения" ввести имя и описание диалога в соответствующие поля; выбрать один из типов:

ВМ: Миграция;

ВМ: Подготовка ресурсов;

Подготовка ресурсов настроенной системы;

Подготовка ресурсов физ. серверов;

в секции "Содержимое" ввести скрипт сценария диалога;

нажать кнопку Добавить.

Добавление нового диалога подготовки ресурсов

Для работы с уже существующими диалогами подготовки ресурсов при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать этот диалог – внести необходимые изменения в параметры диалога;

Копировать этот диалог – копировать один или несколько выбранных диалогов, задав уникальное имя;

Удалить диалог – удалить выбранный диалог из списка, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

##### 8.4.11.1 Диалоги служб

В Комплексе могут быть созданы пользовательские диалоги служб, с помощью которых реализуется сценарий заявок на выделение ВМ или экземпляров.

Для добавления нового диалога необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Настройка"; в левой панели рабочей области выбрать нужный каталог с диалогами служб в иерархическом списке; в правой панели появится список диалогов выбранного каталога;

нажать кнопку Конфигурация, затем – Добавить новый диалог;

в рабочей области "Добавление нового диалога" нужно задать структуру создаваемого диалога (рисунок 138):

в секции "Общее" ввести имя и описание диалога в соответствующие поля;

в секции "Содержимое" ввести скрипт сценария диалога;

в секции формирования диалога с помощью графического интерфейса реализован механизм создания, редактирования и удаления вкладок, секций и элементов управления диалога:

новые вкладки создаются при нажатии кнопки Создать вкладку;

новые секции создаются при нажатии кнопки Создать секцию;

новые элементы создаются перетаскиванием "мышью" соответствующего элемента в секцию

редактирование параметров вкладок, секций и элементов управления осуществляется в параметрально-зависимых модальных окнах "Редактирование подробностей поля" нажатием на пиктограмму  в области элемента; во вкладках "Сведения о поле", "Параметры", "Дополнительно" задаются параметры элемента;

удаление параметров вкладок, секций и элементов управления осуществляется нажатием на пиктограмму  в области элемента.

нажать кнопку Сохранить.

Добавление нового диалога службы

Для работы с уже существующими диалогами службы при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать этот (выбранный) диалог – внести необходимые изменения в параметры диалога;

Копировать этот (выбранный) диалог в новый диалог – копировать один или несколько выбранных диалогов, задав уникальное имя;

Удалить диалог – удалить выбранный диалог из списка, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

##### 8.4.11.2 Кнопки

РОСА Менеджер ресурсов позволяет расширять функциональность веб-интерфейса с помощью добавления пользовательских кнопок для запуска сценариев автоматизации выбранных типов объектов.

Пользовательская кнопка – способ запуска короткого сценария автоматизации – востребована и распространена в производственной инфраструктуре. Например, можно использовать специальные кнопки для запуска резервного копирования ВМ, добавления диска, изменения в конфигурации количества процессоров или расширения оперативной памяти.

В Комплексе имеются встроенные группы кнопок, которые привязаны непосредственно к объектам. Внутри этих групп можно создавать группы кнопок и кнопки, которые также будут привязаны к объекту.

###### 8.4.11.2.1 Группы кнопок

Для создания новой группы настраиваемых кнопок необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Настройка"; в левой панели рабочей области выбрать аккордеон "Кнопки", каталог "Типы объектов" в иерархическом списке (рисунок 139); в правой панели появится список группы кнопок или непосредственно кнопки;

Работа с кнопками объектов

нажать кнопку Конфигурация, затем – Добавить новую группу кнопок;

в рабочей области "Добавление новой группы кнопок" задать параметры (рисунок 140):

"Имя" – наименование группы;

поставить флажок "Показать на кнопке", чтобы имя группы показывалось в каталоге определений;

"Описание" – краткое описание группы;

"Значок" – выбрать изображение для значка группы из коллекции Комплекса, нажав кнопку Применить;

"Цвет значка" – задать цвет значка из предложенной палитры цветов;

"Назначить кнопки" – выбрать параметры фильтров из списка "Не назначен" в список "Выбрано" для назначения этой группе кнопок, используя кнопки "Добавить", "Добавить все", "Удалить", "Удалить все";

нажать кнопку Добавить.

Добавление новой группы кнопок

Для работы с уже существующими группами кнопок при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать эту группу кнопок – внести необходимые изменения в параметры группы кнопок;

Переупорядочить – в рабочей области выбранной группы объекта изменить порядок следования вложенных групп, используя кнопки  и  для перемещения выше или ниже по списку;

Удалить эту группу кнопок – удалить выбранную из списка группу кнопок, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

###### 8.4.11.2.2 Кнопки

Для создания новой кнопки необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Автоматизация  Встроенная автоматизация  Настройка"; в левой панели рабочей области выбрать аккордеон "Кнопки", каталог "Типы объектов" и кнопку или группу кнопок в иерархическом списке в левой панели; в правой панели появятся списки групп кнопок или кнопок;

нажать кнопку Конфигурация, затем – Добавить новую кнопку;

в рабочей области "Добавление новой настраиваемой кнопки" задать параметры:

"Тип кнопки" – выбрать из списка тип кнопки: "По умолчанию" или "Набор сценариев Ansible"; перечень задаваемых параметров зависит от типа выбранной кнопки на вкладке "Параметры":

при выборе "По умолчанию" (рисунок 141) на вкладке "Параметры":

"Имя" – наименование кнопки;

поставить флажок "Показать на кнопке", чтобы имя кнопки показывалось в каталоге определений;

"Описание" – краткое описание кнопки;

"Значок" – выбрать изображение для значка кнопки из коллекции Комплекса, нажав кнопку Применить;

"Цвет значка" – задать цвет значка из предложенной палитры цветов;

"Диалог" – выбрать назначенный этой кнопке диалог из каталога служб;

"Открыть URL" – поставить флажок, чтобы открыть ссылку, доступную только для типов объектов – ВМ, поставщика, службы, пользователя, группы, арендатора, облачного арендатора и общего объекта – с параметром "Показать для" и значением "Отдельный";

"Показать для" – выбрать какой перечень объектов будет показываться для этой кнопки (выражения на вкладке "Дополнительно" можно настроить только для кнопок со значением "Отдельный" для этого параметра);

"Отправить" – выбрать способ отправки "Оправить все" или "Один за другим";

Добавление кнопки типа "Default"

при выборе "Набор сценариев Ansible" (рисунок 142) на вкладке "Параметры":

"Элемент каталога наборов сценариев" – выбрать из раскрывающегося списка один из элементов, назначенный кнопке;

"Инвентарь" – выбрать один из типов инвентаря: "Локальный хост", "Целевая машина" или "Конкретные хосты"; при выборе "Конкретные хосты" нужно ввести в появившееся поле "Введите список имён DNS или IP через запятую" данные о требуемых хостах;

"Имя" – наименование кнопки;

поставить флажок "Показать на кнопке", чтобы имя кнопки показывалось в каталоге кнопок;

"Описание" – краткое описание кнопки;

"Значок" – выбрать изображение для значка кнопки из коллекции Комплекса, нажав кнопку Применить;

"Цвет значка" – задать цвет значка из предложенной палитры цветов;

"Диалог" – выбрать назначенный этой кнопке диалог из каталога служб;

"Открыть URL" – поставить флажок, чтобы открыть ссылку, доступную только для типов объектов – ВМ, поставщика, службы, пользователя, группы, арендатора, облачного арендатора и общего объекта – с параметром "Показать для" и значением "Отдельный";

"Показать для" – выбрать какой перечень объектов будет показываться для этой кнопки (выражения на вкладке "Дополнительно" можно настроить только для кнопок со значением "Отдельный" для этого параметра);

"Отправить" – выбрать способ отправки "Оправить все" или "Один за другим";

Добавление кнопки типа "Набор сценариев Ansible"

при выборе "По умолчанию" на вкладке "Дополнительно":

в секции "Включения использования" нажать кнопку Настроить выражение для построения условия, при котором кнопка будет включена для использования (выражение включения использования можно настроить только для кнопок с установленным значением "Одиночный" для параметра "Показывать для" на вкладке "Параметры");

"Отключённый текст кнопки" – ввести текст, который будет отображаться при наведении "мыши" на кнопку, если условие ее использования не выполняется и кнопка отключена;

в секции "Видимость" нажать кнопку Настроить выражение для построения условия, при котором кнопка будет видима для использования (выражение видимости для использования можно настроить только для кнопок с установленным значением "Одиночный" для параметра "Показывать для" на вкладке "Параметры");

"Система/Процесс" – выбрать назначенное этой кнопке действие из списка модулей или процессов Комплекса;

"Сообщение" – ввести сообщение, выводимое для кнопки;

"Запрос" – ввести выражение для запроса;

ввести атрибуты объекта в виде пар "атрибут/значение";

"Доступ роли" – выбрать доступ к кнопке <Всем> или <По роли>, отметив флажками из появившегося списка роли, которым предоставлен доступ к использованию кнопки.

при выборе "Набор сценариев Ansible" на вкладке "Дополнительно":

в секции "Включения использования" нажать кнопку Настроить выражение для построения условия, при котором кнопка будет включена для использования (выражение включения использования можно настроить только для кнопок с установленным значением "Одиночный" для параметра "Показывать для" на вкладке "Параметры");

"Отключённый текст кнопки" – ввести текст, который будет отображаться при наведении "мыши" на кнопку, если условие ее использования не выполняется и кнопка отключена;

в секции "Видимость" нажать кнопку Настроить выражение для построения условия, при котором кнопка будет видима для использования (выражение видимости для использования можно настроить только для кнопок с установленным значением "Одиночный" для параметра "Показывать для" на вкладке "Параметры");

ввести атрибуты объекта в виде пар "атрибут/значение";

"Доступ роли" – выбрать доступ к кнопке <Всем> или <По роли>, отметив флажками из появившегося списка роли, которым предоставлен доступ к использованию кнопки.

Для работы с уже существующими кнопками при нажатии Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать эту кнопку – внести необходимые изменения в параметры кнопки;

Удалить эту кнопку – удалить выбранную из списка кнопку, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

Примечание – Для вставки в параметры кнопки сведений об объекте, скопированных при имитации, можно использовать пиктограмму  в левом верхнем углу рабочей области.

##### 8.4.11.3 Импорт/экспорт диалога службы

Для импорта/экспорта диалогов службы между серверами разных экземпляров Комплекса нужно выбрать в меню панели навигации "Автоматизация  Встроенная автоматизация  Импорт/Экспорт"; в левой панели рабочей области выбрать аккордеон "Импорт/Экспорт", каталог "Импорт/Экспорт диалога службы" в иерархическом списке; в правой панели появится функционал для импорта и экспорта диалога службы (рисунок 143).

Для импорта в секции "Импорт" нужно нажать кнопку Выберите файл, выбрать файл средствами ОС и нажать Отправить.

Для экспорта в списке служб секции "Экспорт" выбрать одну или несколько служб, нажать кнопку Экспорт и сохранить файл стандартными средствами браузера.

Импорт/экспорт диалогов службы