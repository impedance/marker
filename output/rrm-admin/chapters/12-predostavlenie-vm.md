## 12 Предоставление ВМ

Процесс предоставления ВМ через РОСА Менеджер ресурсов состоит из следующих основных этапов:

формирование запроса на предоставление ВМ;

одобрение (утверждение) запроса администратором Комплекса или специальным уполномоченным пользователем;

предоставление ВМ на основании утвержденного запроса.

Запрос на предоставление ВМ формируется пользователем и содержит сведения об инициаторе запроса, выбранный шаблон ВМ, требования к виртуальному оборудованию, настройки ОС ВМ, расписание предоставления ВМ. Процедура формирования запроса на предоставление подробно описана в документе "РОСА Менеджер ресурсов. Руководство пользователя" (шифр – РСЮК.10111-04 34 01).

Сформированный запрос проходит процедуру утверждения, которая может выполняться как в автоматическом режиме, так и вручную администратором (уполномоченным пользователем).

Выполнение запроса на предоставление ВМ включает подготовительную и завершающую стадии. Подготовительная стадия состоит из получения IP-адреса для пользователя (инициатора запроса) и создания записи в CMDB, после чего выполняется непосредственно создание ВМ с использованием информации, представленной в запросе. На завершающей стадии активируются необходимые данные в CMDB и отправляется электронное письмо инициатору запроса (рисунок 195).

Процесс предоставления ВМ

Следует обратить внимание, что серверу Комплекса должна быть присвоена роль "Automation Engine" для обеспечения процесса предоставления ВМ. Для этого в секции "Управление сервером", доступной в меню "Параметры → Параметры приложения" панели навигации нужно установить переключатель роли "Automation Engine" в положение Вкл.

Пользователь Комплекса может формировать следующие типы запросов на предоставление ВМ:

запрос на предоставление новой ВМ из шаблона;

запрос на клонирование ВМ;

запрос на публикацию ВМ в виде шаблона.

Примечание – Шаблон ВМ представляет собой копию ВМ, которую можно использовать для унификации повторяющихся процессов создания одинаковых ВМ. В шаблоне фиксируется предустановленная конфигурация ОС и прикладного ПО, а также аппаратная конфигурация ВМ, на основе которой был создан шаблон.

### 0.1 Предоставление новой ВМ из шаблона

Формирование запроса на предоставление новой ВМ из шаблона осуществляется выполнением следующих действий:

в меню панели навигации выбрать пункт "Ресурсы → Инфраструктура → Виртуальные машины" (рисунок 196);

Список ВМ и шаблонов

выбрать необходимый шаблон ВМ из списка;

нажать кнопку Жизненный цикл и выбрать Подготовить ресурсы ВМ с использованием этого шаблона;

на экране появится интерфейс добавления в Комплекс нового запроса, который содержит параметры запроса и необходимые параметры предоставляемой ВМ, которые распределены по вкладкам для последовательной настройки (рисунок 197):

Добавление нового запроса

во вкладке "Запрос" указать сведения об инициаторе запроса: в соответствующие поля ввести имя и адрес электронной почты инициатора запроса для получения им сообщений об изменении статуса запроса: автоматическое одобрение запроса, предоставление ВМ завершено, запрос устарел, запрос ожидает утверждения, запрос отклонен;

во вкладке "Назначение" при необходимости присвоить ранее созданный тег (теги) предоставляемой ВМ;

во вкладке "Каталог" настроить общие параметры предоставляемой ВМ; доступные для настройки общие параметры являются вариативными и зависят от типа выбранного шаблона ВМ, ранее созданного на основе ВМ, например VMware или ROSA Virtualization (рисунок 198):

Вкладка "Каталог"

для настройки общих параметров предоставляемой ВМ VMware выполнить следующие действия:

из раскрывающегося списка "Тип предоставления" выбрать необходимое значение: VMware – при выборе этого значения установить флажок "Связанный клон", после чего выбрать снимок ВМ для создания связанного клона вместо полного клона ВМ; PXE – при выборе этого значения указать сервер PXE и образ ВМ;

из раскрывающегося списка "Количество" выбрать количество ВМ, создаваемых по этому запросу;

в соответствующих полях ввести наименование и краткое описание новой ВМ.

Примечание – При создании нескольких одинаковых ВМ к указанному наименованию ВМ будет добавлен порядковый номер.

для настройки общих параметров предоставляемой ВМ ROSA Virtualization выполнить следующие действия:

из раскрывающегося списка "Тип предоставления" выбрать необходимое значение: ISO – при выборе этого значения указать ISO-образ ВМ; PXE – при выборе этого значения указать сервер PXE и образ ВМ; "Собственный клон" – выбор этого значения позволяет использовать шаблон ВМ, созданный с поддержкой возможностей Cloud-Init по автоматической настройке пользовательских параметров ВМ в процессе инициализации новой ВМ#

из соответствующего раскрывающегося списка выбрать количество ВМ, создаваемых по этому запросу.

в соответствующих полях ввести наименование и краткое описание новой ВМ.

Примечание – При создании нескольких одинаковых ВМ к указанному наименованию ВМ будет добавлен порядковый номер.

во вкладке "Окружение" выбрать ресурсы для расположения новой ВМ:

для предоставляемой ВМ VMware установить флажок "Выбирать автоматически" или выбрать определенный ЦОД, кластер, пул ресурсов, папку, хост и хранилище данных.

Примечание – В секции "Хранилище данных" виртуальной машине VMware можно присвоить профиль хранилища. При этом хранилища данных с режимом доступа только для чтения будут являться недоступными для расположения предоставляемой ВМ.

для предоставляемой ВМ ROSA Virtualization установить флажок "Выбирать автоматически" или выбрать определенный центр обработки данных, кластер, хост и хранилище данных.

во вкладке "Оборудование" настроить параметры оборудования новой ВМ следующим образом (рисунок 199):

Вкладка "Оборудование"

выбрать необходимые значения из раскрывающихся списков "Количество сокетов", "Количество ядер ЦП на сокет", "Память (Мбайт)".

установить соответствующий переключатель в одно из следующих положений для выбора формата диска ВМ и варианта резервирования объема дискового пространства в хранилище данных:

QCOW2 – формат виртуального диска с тонким резервированием объема пространства по необходимости;

Raw – формат виртуального диска с тонким резервированием или предварительным резервированием (выделением) всего объема пространства единовременно; в этом случае вариант резервирования зависит от типа используемого хранилища данных (соответственно файловое или блочное хранилище);

Как в шаблоне – параметры виртуального диска наследуются из шаблона ВМ (значение по умолчанию).

в соответствующем поле секции "Лимиты ВМ" установить ограничение на максимальное значение используемого объема оперативной памяти в Мбайт для предоставляемой ВМ VMware;

в соответствующем поле секции "Резервы ВМ" указать значение зарезервированного объема оперативной памяти в Мбайт для предоставляемой ВМ VMware;

во вкладке "Сеть" указать сеть vLan, к которой будет подключен виртуальный сетевой адаптер новой ВМ (рисунок 200); из раскрывающегося списка в секции "Сведения об адаптере сети" выбрать необходимую сеть vLan. В общем случае подключение предоставляемой ВМ осуществляется к виртуальной сети управления ovirtmgmt.

Вкладка "Сеть"

Примечание – ВМ VMware можно подключить к необходимой сети vLan через группу портов DVPortgroup, предварительно созданную на распределенном коммутаторе vSphere (VDS) в VMware vCenter. В этом случае следует выбрать "DVPortgroup" в списке доступных сетей vLan.

во вкладке "Настройка ОС" настроить параметры ОС ВМ, необходимые для предоставления этой ВМ. Доступные для настройки параметры ОС являются вариативными и зависят от типа ОС в шаблоне ВМ – ОС семейства Linux или ОС семейства Windows.

Примечание – Вкладка "Настройка ОС" будет скрыта от пользователя, если в шаблоне ВМ указан неизвестный (unknown) тип ОС.

для настройки параметров ОС семейства Linux выполнить следующие действия:

в соответствующем поле секции "Учетные данные" задать пароль для учетной записи суперпользователя root;

выбрать протокол DHCP для автоматической настройки IP-адреса сетевого адаптера предоставляемой ВМ или ввести статическое значение IP-адреса;

при необходимости указать IP-адрес сервера DNS;

при наличии выбрать из соответствующего списка необходимый файл ответов Kickstart или Cloud-Init для автоматической настройки пользовательских параметров ОС в процессе инициализации новой ВМ;

для настройки параметров ОС семейства Windows выполнить один из следующих способов с использованием (при наличии) подготовленной спецификации с пользовательскими параметрами ОС или файла ответов Sysprep:

из раскрывающегося списка выбрать значение "Спецификация", после чего выбрать необходимый файл с предустановленными параметрами ОС;

из раскрывающегося списка выбрать значение "Файл ответов Sysprep", после чего загрузить необходимый файл ответов в Комплекс и выбрать этот файл из общего списка для автоматической настройки пользовательских параметров ОС в процессе инициализации новой ВМ. Следует обратить внимание, что РОСА Менеджер ресурсов использует для настройки ОС значения только необходимых параметров из указанных в спецификации или файле ответов. Например, не применяются параметры однократного запуска ВМ, а если указано более одного сетевого адаптера, используется только первый по порядку. Для ОС семейства Windows применяются параметры автоматического входа в ОС без пароля, идентификационные и пользовательские данные, информация о рабочей группе и лицензия ОС;

во вкладке "Расписание" задать расписание предоставления ВМ следующим образом (рисунок 201):

Вкладка "Расписание"

установить переключатель "Начало предоставления ВМ" в одно из следующих положений:

По расписанию – при выборе этого значения указать дату и время начала предоставления ВМ;

Сразу после утверждения – предоставление ВМ начнется сразу после утверждения запроса;

при необходимости установить флажок "Без сохранения состояния";

Примечание – ВМ без сохранения состояния не записывает свои файлы на диск, поэтому при следующей загрузке снова потребуется образ ВМ с сервера PXE.

установить флажок "Включать ВМ после создания";

указать дату завершения предоставления ВМ, после чего выбрать временной интервал перед завершением для формирования соответствующего сообщения с напоминанием;

нажать кнопку Отправить.

В результате каждому запросу на предоставление ВМ присваивается уникальный числовой идентификатор, который состоит из кода региона и порядкового номера запроса. Например, запросу 32, сформированному в регионе 177, будет присвоен идентификатор 177000000000032. При необходимости используют идентификатор запроса для поиска информации о запросе в системных журналах.

Сформированный запрос проходит процедуру утверждения (или отклонения), которая может выполняться как в автоматическом режиме, так и вручную администратором или уполномоченным пользователем.

Примечание – При необходимости администратор Комплекса может редактировать и удалять запросы.

В случае одобрения запроса осуществляется создание и предоставление ВМ.

Инициатору запроса отправляются электронные письма с сообщениями об изменении статуса запроса: автоматическое одобрение запроса, предоставление ВМ завершено, запрос устарел, запрос ожидает утверждения, запрос отклонен.

### 12.1 Клонирование ВМ

Формирование запроса на клонирование ВМ осуществляется выполнением следующих действий:

Примечание – Данная процедура выполняется только для виртуальных машин VMware.

в меню панели навигации выбрать пункт "Ресурсы → Инфраструктура → Виртуальные машины";

выбрать необходимую ВМ;

нажать кнопку Жизненный цикл и выбрать Клонировать выбранный элемент;

во вкладках интерфейса проверить доступные параметры ВМ и настроить параметры запроса согласно п.12.1;

нажать кнопку Отправить.

### 12.2 Публикация ВМ в виде шаблона

Формирование запроса на публикацию ВМ в виде шаблона осуществляется выполнением следующих действий.

Примечание – Данная процедура выполняется только для виртуальных машин VMware.

в меню панели навигации выбрать пункт "Ресурсы → Инфраструктура → Виртуальные машины";

выбрать необходимую ВМ;

нажать Жизненный цикл и выбрать Опубликовать выбранную ВМ как шаблон;

во вкладках интерфейса проверить доступные параметры ВМ и настроить параметры запроса по аналогии с подразделом 12.1;

нажать кнопку Отправить.

### 12.3 Переименование предоставляемой ВМ

Переименование предоставляемой ВМ (без повторной инициализации этой ВМ) осуществляется выполнением следующих действий:

Примечание – Данная процедура выполняется только для виртуальных машин VMware.

в меню панели навигации выбрать пункт "Ресурсы → Инфраструктура → Виртуальные машины";

выбрать необходимую ВМ;

нажать кнопку Конфигурация и выбрать Редактировать эту ВМ;

в соответствующем поле ввести новое наименование ВМ;

нажать кнопку Сохранить.