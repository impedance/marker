## 7 Контроль

### 7.1 Политики

Политики используются для контроля за виртуальной инфраструктурой. Доступны два режима политик: политики соответствия требованиям и политики контроля. Политики соответствия требованиям используются для усиления защиты виртуальной инфраструктуры и обеспечения соблюдения требований безопасности. Политики контроля используются для проверки определенного условия и выполнения действий на основе результата.

Примеры политик:

Запретить запуск виртуальных машин без учетной записи администратора.

Запретить запуск виртуальных машин, если не установлены определенные исправления.

Настроить поведение рабочей ВМ так, чтобы она запускалась только в том случае, если она работает на рабочем хосте.

Принудительно выполнять анализ SmartState при добавлении или удалении хоста из кластера.

#### 7.1.1 Политики контроля

Политика контроля представляет собой комбинацию события, условия и действия. Эта комбинация обеспечивает возможности управления в виртуальной инфраструктуре:

"Событие" – это триггер для проверки условия;

"Условия" – это проверка, запускаемая событием;

"Действие" – это выполнение, которое происходит при соблюдении условия.

Для создания новой политики контроля необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Контроль → Политики"; в рабочей области появится список существующих политик с описанием, признаком активности, типом и режимом;

нажать кнопку Конфигурация, затем –  Добавить новую политику (рисунок 102);

в рабочей области "Добавление новой политики" задать параметры политики:

в секции "Основные сведения" – ввести описание в соответствующее поле; указать флажком, если политика активна; выбрать объект политики в раскрывающемся списке "Применимо к"; выбрать из списка "Режим" вид политики: "Контроль" или "Соответствие требованиям";

в секции "Область применения" редактировать выражение с помощью элементов, условий и значений;

в секции "Примечания" ввести подробную информацию о политике.

нажать кнопку Добавить.

Добавление новой политики

Для вновь созданной политики контроля при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия для политик контроля:

Редактировать назначений условий выбранной политики – выбрать доступные условия из левой панели и перенести в условия политики с помощью кнопки , удалить все или одно условия – с помощью кнопок  и  соответственно (рисунок 103); нажать кнопку Сохранить;

Редактирование условий политики

Редактировать назначений событий выбранной политики – выбрать события политики контроля, поставив переключатели необходимых событий в положение "Да" (рисунок 104); нажать кнопку Сохранить;

Редактирование событий политики

Редактировать действия для событий выбранной политики – для каждого события, выбранного при редактировании событий, нужно выбрать для двух блоков "Порядок действий, если ВСЕ условия истинны" и "Порядок действий, если КАКИЕ-ТО условия ложны" (условия задаются при редактировании условий текущей политики) из списка доступных действий в список выбранных действий с помощью кнопок ,  и ; в списке выбранных действий определить порядок выполнения действий с помощью кнопок  и ; в списке выбранных действий указать на синхронное или асинхронное выполнение действий для групп действий, которые можно выбрать с использованием клавиши CTRL, используя кнопки  (синхронное) или  (асинхронное); нажать кнопку Сохранить (рисунок 105).

Редактирование действий политики

Для работы с существующими политиками следует выбрать нужные политики, нажать кнопку Конфигурация и выбрать одно из действий в появившемся меню:

Редактировать выбранную политику – внести необходимые изменения в параметры политики;

Копировать выбранную политику – будет создана копия политики, которую затем можно редактировать, указав уникальное имя и при необходимости внести изменения в параметры политики;

Удалить выбранных пользователей – удалить выбранные флажками из списка политики, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

#### 7.1.2 Политики соответствия

Политики соответствия предназначены для защиты инфраструктуры путем проверки условий, которые можно создавать. Эти условия могут включать в себя те же условия, которые бы использовались в политике контроля, при этом большинство процедур создания одинаковы (см. раздел 7.1.1). Однако политика соответствия автоматически присваивает отметку действию, соответствующему требованиям, когда тип объекта (например, ВМ или хост), к которому применяется политика, соответствует всем условиям. Если какое-либо из условий не выполняется, то ВМ или хост помечается как несоответствующие. Статус соответствия отображается на сводном экране для типа объекта, а также на экранах сравнения и дрейфа.

Политики соответствия создают, назначив или создав условия. Комплекс автоматически назначает события и действия политике соответствия, а не политике контроля, в которой требуется определить это вручную. Событие проверки соответствия типа объекта (например, ВМ или хост) назначается политике соответствия. Политика соответствия помечает действие как соответствующее, когда ВМ или хост соответствует всем условиям. Если какое-либо из условий не выполняется, то ВМ или хост помечается как несоответствующие. Для просмотра отметки о соответствии нужно нажать на политику с типом соответствия и в рабочей области в секции "Действия" будет присутствовать "Mark as Compliant (Отмечено как соответствующее)" или "Mark as Non-Compliant (Отмечено как несоответствующее)" в секции действия (рисунок 106).

Просмотр политики соответствия

Рекомендуется тщательно планировать цель политики прежде, чем создавать ее. Также возможно использование выражения, которое проверяется немедленно, когда событие проверки соответствия запускает политику. Если элемент выходит за пределы области действия, политика не действует в соответствии с условиями, и ни одно из связанных действий не выполняется.

#### 7.1.3 Имитация политики

Прежде чем назначать профиль политики объектам инфраструктуры, рекомендуется использовать функцию моделирования событий Комплекса, чтобы определить, будет ли соответствовать объект профилю политики.

Имитация события осуществляется выполнением следующих действий:

в меню панели навигации выбрать пункт "Контроль → Имитация"; в рабочей области появятся блоки выбора событий и результатов имитации (рисунок 107);

в блоке выбора событий необходимо задать из раскрывающихся списков "Тип" события, "Событие" и области применения события, контекстно-зависимые от типа и события;

нажать кнопку Отправить.

В блоке результатов имитации появится описание в виде иерархии полученных данных, которые можно отфильтровать, используя блок "Показать параметры" и отмечая флажками:

"Показать элементы вне области применения" – отобразить все условия независимо от того, соответствует ли объект части области действия условия;

"Показать политики: Пройдено" – отобразить принятые политики;

"Показать политики: Сбой" – отобразить политики, которые не были выполнены.

Элементы, выделенные зеленым текстом, соответствуют условию.

Элементы, выделенные красным текстом, не соответствуют условию.

Элементы, выделенные красным курсивом, не соответствуют условию, но не изменяют результат области применения.

Развернуть или свернуть иерархический список можно, используя пиктограммы  и  соответственно.

Имитация политик

#### 7.1.4 Экспорт политик

Экспорт политик из Комплекса осуществляется выполнением следующих действий:

в меню панели навигации выбрать пункт "Контроль → Импорт/Экспорт";

в секции "Экспорт" из раскрывающегося списка "Экспорт" выбрать значение "Политики";

в списке "Доступные политики" выбрать одну или несколько политик для экспорта (рисунок 108);

Импорт/экспорт политик

Примечание – Можно использовать клавишу Ctrl для выбора нескольких политик из списка.

нажать кнопку Экспорт;

сохранить файл экспортируемой политики стандартными средствами браузера.

Примечание – Операции экспорта и импорта политик могут выполняться между различными экземплярами РОСА Менеджер ресурсов одинаковой версии.

#### 7.1.5 Импорт политик

Импорт политик в РОСА Менеджер ресурсов осуществляется выполнением следующих действий:

в меню панели навигации выбрать пункт "Контроль → Импорт/Экспорт";

в секции "Импорт" нажать кнопку Выберите файл, после чего выбрать файл импортируемой политики;

нажать кнопку Отправить.

### 7.2 Профили политики

Профили политик – это группы политик, которые можно назначать сразу многим ВМ, поставщикам, кластерам, хостам, пулам ресурсов, репликаторам, модулям, узлам контейнеров и образам контейнеров. Профили политик обеспечивают основу для простого управления и назначения разных уровней безопасности, включая различные типы облачных ресурсов.

Для создания нового профиля политики необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Контроль → Профили политик"; в рабочей области появится список существующих профилей политик;

нажать кнопку Конфигурация, затем – Добавить новый профиль политики (рисунок 109);

в рабочей области "Добавление нового профиля политики" задать параметры:

ввести описание профиля в соответствующее поле;

выбрать из списка доступных политик, помечая флажками и нажимая клавиши Добавить, Добавить все, Удалить, Удалить все, политики, применяемые в профиле;

ввести в поле "Примечания" подробное описание профиля политик;

нажать кнопку Добавить.

Добавление нового профиля политики

Для работы с существующими профилями политик следует выбрать нужные профили, нажать кнопку Конфигурация и выбрать одно из действий в появившемся меню:

Редактировать выбранный профиль политики – внести необходимые изменения в параметры профиля;

Удалить профили политики – удалить выбранные флажками из списка профили, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

#### 0.0.1 Назначение профилей политики

После создания профилей политики их можно оценить и назначить объектам инфраструктуры:

виртуальной машине – применить профиль политики к конкретной ВМ независимо от связанного с ней хоста, поставщика или репозитория;

поставщику – применить профиль политики ко всем ВМ, хостам, репликаторам, модулям, узлам контейнеров или образам контейнеров, зарегистрированным у этого поставщика;

репликатору – применить профиль политики к этому конкретному репликатору;

поду – применить профиль политики к этому конкретному модулю;

узлу контейнера – применить профиль политики к этому конкретному узлу;

образу контейнера – применить профиль политики к этому конкретному образу;

кластеру – применить профиль политики ко всем ВМ или хостам, назначенным этому кластеру;

хосту – применить профиль политики к этому конкретному хосту или ко всем ВМ, зарегистрированным на этом хосте;

пулу ресурсов – применить профиль политики ко всем ВМ или хостам, назначенным этому пулу ресурсов.

Назначение профилей политики ресурсам осуществляется в разделе меню "Ресурсы" в аккордеонах "Облака", "Инфраструктура", "Физич. инфраструктура", "Контейнеры". Для этого необходимо выполнить следующие действия:

в развернутом аккордеоне выбрать требуемый ресурс, например "Инфраструктура  Поставщики" (рисунок 110);

выбрать поставщика, нажать кнопку Политики и выбрать Управление политиками;

в появившейся рабочей области в секции "Выбрать профили политики" назначить профили политик для выбранного поставщика, отметив их флажками;

нажать кнопку Сохранить.

Назначение профилей политик поставщику инфраструктуры

#### 0.0.2 Экспорт профилей политик

Экспорт профилей политик из Комплекса осуществляется выполнением следующих действий:

в меню панели навигации выбрать пункт "Контроль → Импорт/Экспорт";

в секции "Экспорт" из раскрывающегося списка "Экспорт" выбрать значение "Профили политик";

в списке "Доступные профили" выбрать один или несколько профилей для экспорта (рисунок 111);

Импорт/экспорт профилей политик

Примечание – Можно использовать клавишу Ctrl для выбора нескольких профилей политик из списка.

нажать кнопку Экспорт;

сохранить файл экспортируемого профиля политики стандартными средствами браузера.

Примечание – Операции экспорта и импорта профилей политик могут выполняться между различными экземплярами РОСА Менеджер ресурсов одинаковой версии.

#### 7.2.1 Импорт профилей политик

Импорт профилей политик в РОСА Менеджер ресурсов осуществляется выполнением следующих действий:

в меню панели навигации выбрать пункт "Контроль → Импорт/Экспорт";

в секции "Импорт" нажать кнопку Выберите файл, после чего выбрать файл импортируемого профиля политики.

нажать кнопку Отправить.

### 7.3 Условия

Условия – это проверки, которые выполняются над характеристиками ВМ. Условия может содержать два элемента: область действия и выражение. Выражение является обязательным, но область действия не является обязательной. Область действия – это общий атрибут, который быстро проверяется перед вычислением более сложного выражения. Например, можно использовать область для проверки ОС и использовать выражение для проверки определенного набора приложений или исправлений безопасности, которые применяются только к ОС, указанной в области. Если для политики не определены условия, область действия или выражение, политика считается безусловной и возвращает значение "TRUE (ИСТИНА)".

Для создания нового условия необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Контроль → Условия"; в рабочей области появится список существующих условий;

нажать кнопку Конфигурация, затем – Добавить новое условие (рисунок 112);

в рабочей области "Добавление нового условия" задать параметры:

ввести описание условия в соответствующее поле;

выбрать из раскрывающегося списка "Применимо к" ресурс, к которому будет применяться это условие;

при необходимости редактировать выражения для поля "Область применения";

редактировать "Выражение" для создания собственно условия;

ввести в поле "Примечания" подробное описание условия;

нажать кнопку Добавить.

Добавление нового условия

Для работы с существующими условиями следует выбрать нужные условия, нажать кнопку Конфигурация и выбрать одно из действий в появившемся меню:

Редактировать выбранное условие – внести необходимые изменения в параметры условия;

Удалить условия – удалить выбранные флажками из списка условий, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

### 7.4 Действия

Действия выполняются после оценки условия. В Комплексе предоставляется набор действий по умолчанию, которые можно использовать (таблица 6). Также возможно создавать собственные действия.

Перечень действий по умолчанию

Создание пользовательских действий осуществляется на основе настраиваемых действий, существующих в Комплексе (таблица 7).

Перечень настраиваемых действий

Для создания нового действия необходимо выполнить следующие шаги:

в меню панели навигации выбрать пункт "Контроль → Действия"; в рабочей области появится список существующих действий;

нажать кнопку Конфигурация, затем – Добавить новое действие (рисунок 113);

в рабочей области "Добавление нового действия" задать параметры:

ввести описание действия в соответствующее поле;

выбрать из раскрывающегося списка "Тип действия" действие, подлежащее дальнейшей настройке;

Примечание – Набор параметров для каждого типа действий отличаются.

ввести или выбрать значения параметров, предлагаемых в зависимости от выбранного типа действия;

нажать кнопку Добавить.

Добавление нового действия

Для работы с существующими действиями следует выбрать нужные действия, нажать кнопку Конфигурация и выбрать одну из опций в появившемся меню:

Редактировать выбранное действие – выбрать действие и внести необходимые изменения в параметры действия;

Удалить действия – удалить выбранные флажками из списка действия, подтвердив удаление нажатием кнопки Да в появившемся модальном окне.

При создании политики можно связать созданные действия с конкретными событиями.

### 7.5 События

События – это триггеры, которые вызывают проверку состояния. Комплекс предоставляет несколько событий, которые можно разделить на функциональные типы. События не могут быть изменены.

Для просмотра событий необходимо выполнить следующие действия:

в меню панели навигации выбрать пункт "Контроль → События"; в рабочей области появится список существующих событий с описанием, типом и отнесением к группе;

нажать на требуемое событие; в рабочей области отобразится информация о событии: наименование, отнесение к группе, назначение политикам (рисунок 114).

Информация о событии

Описание групп событий представлено в таблице 8.

Группы событий

Каждая группа событий имеет набор событий, которые можно выбрать для запуска проверки условия (таблица 9).

Перечень событий по умолчанию

Прежде чем назначать профиль политики ВМ, следует использовать функцию моделирования (имитации) политики контроля Комплекса, чтобы определить, соответствует ли ВМ профилю политики.