## 11 Службы

### 11.1 Мои службы

Службы предоставляют возможность для создания шаблонов и каталогов служб. Этот функционал помогает распределять многоуровневые рабочие нагрузки между поставщиками, а также позволяет создавать и утверждать запросы на службы и каталоги служб.

Механизм работы со службами доступен в меню панели навигации "Службы  Мои службы", при выборе которой в рабочей области отображается список предоставленных служб в табличном виде с описанием наименования, типа, признака вывода из эксплуатации, временем создания, числом ВМ, количеством ЦП, объемом памяти по этой службе и данными по дисковому пространству (рисунок 179).

Список можно фильтровать выбором опции из "Глобального фильтра". Если необходимо постоянно использовать выбранный фильтр, можно нажать кнопку Установить значением по умолчанию.

Список используемых служб

Для работы со службами можно осуществлять следующие действия в соответствии с опциями меню быстрого доступа, предварительно отметив флажками необходимые одну или несколько служб:

кнопка Конфигурация:

Редактировать выбранную службу – редактировать параметры службы "Имя" и "Описание" в соответствующих полях;

Удалить службу из инвентаря – удалить выбранные службы, подтвердив действие нажатием кнопки Да в появившемся модальном окне;

Настроить владельца – редактировать параметры службы выбором из "Выберите владельца" пользователя и из раскрывающегося списка "Выберите группу" группу пользователей с соответствующими ролями;

кнопка Политика:

Редактировать теги – в появившейся рабочей области выбрать из раскрывающихся списков "Категорию" и "Значение" для назначения тега выбранным службам;

кнопка Политика:

Настроить даты вывода из эксплуатации – выбрать один из типов вывода из эксплуатации:

"Конкретная дата и время" – в появившемся поле выбрать или ввести "Дату вывода из эксплуатации";

"Задержка времени с данного момента" – в появившихся полях задать относительный период в полях "Месяцы", "Недели", "Дни", "Часы"; в списке "Предупреждение о выводе из эксплуатации" выбрать "Нет", "1 неделя до вывода из эксплуатации", "2 недели до вывода из эксплуатации", "30 дней до вывода из эксплуатации";

Примечание – Сохранение пустых данных удалит все даты вывода из эксплуатации.

Вывести выбранные элементы из эксплуатации – немедленно вывести из эксплуатации выбранные службы, нажав кнопку Да для подтверждения в появившемся модальном окне.

По окончании действий следует нажать кнопку Сохранить.

После вывода из эксплуатации по требованию рабочая область автоматически обновится до "Службы  Запросы", в которой появится новый запрос со статусом "Одобрено".

### 11.2 Каталоги

Каталоги – это еще один способ подготовки набора экземпляров или ВМ, который используется для создания стеков приложений, содержащих более одного экземпляра или ВМ. Вместо подготовки каждой ВМ вручную можно создать каталог, содержащий всю информацию о развертывании, и, таким образом, обратиться к одному шаблону для подготовки всего стека. Если в каталоге включена подготовка, он называется каталогом служб.

Для работы с каталогами служб нужно выбрать в меню панель навигации "Службы  Каталоги"; в левой панели рабочей области отображаются аккордеоны "Каталоги служб", "Элементы каталога", "Шаблоны оркестрации", "Каталоги", которые разворачиваются до вложенных каталогов и элементов в иерархическом виде, в правой – списки элементов каталогов или содержание элементов (рисунок 180).

Каталоги служб

#### 0.0.1 Заказ службы

При выборе в левой панели в аккордеоне "Каталоги служб" конкретной службы каталога в правой панели появится описание основных сведений службы, связанного диалога и кнопка Заказать, по нажатию на которую можно перейти к диалогу для заявки на службу, заполнить параметры и нажать кнопку Отправить (рисунок 181).

Заказ службы

После отправки заказа он рабочая область автоматически обновится до "Службы  Запросы", в котором появится новый заказ со статусом "Ожидается одобрение".

#### 11.2.1 Элементы каталога

При выборе в левой панели аккордеона "Элементы каталога" можно работать с отдельными элементами как с назначенными каталогам, так и не назначенными (unassigned) (рисунок 182).

Элементы каталога

Для добавления нового элемента каталога нужно выполнить следующие действия:

в меню панели навигации выбрать пункт "Службы → Каталоги";

развернуть аккордеон "Элементы каталога" и выбрать в меню пункт с именем каталога или "Unassigned";

нажать кнопку Конфигурация и выбрать Добавить новый элемент каталога;

на экране появится интерфейс "Добавление нового элемента каталога служб", в котором нужно выбрать один из типов элемента – "Ansible Playbook", "Generic", "oVirt", "VMware", "VMwate Content Library OVF Template" и задать во вкладках параметры, состав которых зависит от выбранного типа элемента (рисунок 183).

Выбор типа элемента каталога служб

Для работы с уже существующими элементами каталога при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать этот элемент – внести необходимые изменения в параметры элемента;

Копировать выбранный элемент – копировать, задав уникальное "Имя" элемента;

Удалить этот элемент – удалить выбранный элемент, подтвердив действие нажатием кнопки Да в появившемся модальном окне;

Настроить владельца – редактировать параметры элемента выбором из "Выберите владельца" пользователя и из раскрывающегося списка "Выберите группу" группы пользователей с соответствующими ролями.

Для редактирования тегов элементов каталога нужно нажать на кнопку Политики и выбрать Редактировать теги; в появившейся рабочей области выбрать из раскрывающихся списков "Категорию" и "Значение" тега; нажать кнопку Сохранить.

Назначение кнопок и групп кнопок элементам каталогов осуществляется по аналогии с п.8.4.11.3.

#### 11.2.2 Набор каталогов

Для добавления нового набора каталогов, включающего несколько ресурсов, нужно выполнить следующие действия:

в меню панели навигации выбрать пункт "Службы → Каталоги";

развернуть аккордеон "Элементы каталога" и выбрать в меню пункт с именем каталога или "Unassigned";

нажать кнопку Конфигурация и выбрать Добавить новый набор каталога;

на экране появится интерфейс "Добавление нового набора каталога", в котором нужно задать параметры, распределенные по вкладкам (рисунок 184):

во вкладке "Основные сведения":

ввести имя и описание в соответствующие поля;

поставить флажок "Показать в каталоге" для отображения набора в каталоге;

выбрать из раскрывающегося списка "Каталог", в какой каталог этот набор будет назначен или останется не назначенным;

выбрать из раскрывающегося списка "Диалог" для назначения набору;

выбрать из раскрывающегося списка "Выберите валюту" валюту;

ввести в поле "Цена/Месяц" стоимость в единицах валюты для этого набора элементов;

задать в поле "Точка входа подготовки ресурсов" по нажатию пиктограммы  во всплывающем модальном окне "Выбрать точку входа Instance" нужный класс (очистить выбранный список можно пиктограммой ); при необходимости поставить флажок в опцию "Включить в путь префикс домена" для указания полного пути копирования; нажать кнопку Применить;

задать в поле "Изменить конфигурацию точки входа" по нажатию пиктограммы  во всплывающем модальном окне "Выбрать точку входа Instance" нужный класс (очистить выбранный список можно пиктограммой ); при необходимости поставить флажок в опцию "Включить в путь префикс домена" для указания полного пути копирования; нажать кнопку Применить;

задать в поле "Точка входа вывода из эксплуатации" по нажатию пиктограммы  во всплывающем модальном окне "Выбрать точку входа Instance" нужный класс (очистить выбранный список можно пиктограммой ); при необходимости поставить флажок в опцию "Включить в путь префикс домена" для указания полного пути копирования; нажать кнопку Применить;

выбрать в иерархическом списке "Дополнительные арендаторы" назначенных арендаторов;

Добавление нового набора каталогов

во вкладке "Выбранные ресурсы":

выбрать из раскрывающегося списка "Добавить ресурс" все ресурсы, которые нужно добавить в набор;

в таблице добавленных ресурсов задать в соответствующих столбцах "Порядок действий", "Порядок подготовки ресурсов", выбрать действия при запуске и останове, задержки в выполнении действий при запуске и останове;

нажать кнопку Добавить.

Для работы с уже существующими наборами каталога при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать этот элемент – внести необходимые изменения в параметры набора;

Копировать выбранный элемент – копировать, задав уникальное "Имя" набора;

Удалить этот элемент – удалить выбранный набор, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

Настроить владельца – редактировать параметры набора выбором из "Выберите владельца" пользователя и из раскрывающегося списка "Выберите группу" группы пользователей с соответствующими ролями.

Для редактирования тегов набора каталога нужно нажать на кнопку Политики и выбрать Редактировать теги; в появившейся рабочей области выбрать из раскрывающихся списков "Категорию" и "Значение" тега; нажать кнопку Сохранить.

Назначение кнопок и групп кнопок набору каталогов осуществляется по аналогии с п.8.4.11.3.

#### 11.2.3 Шаблоны оркестрации

Комплекс поддерживает ряд встроенных типов шаблонов оркестрации, которые упрощают развертывание сложных служб. Шаблоны оркестрации добавляют как элементы каталога в каталог служб. Также можно создавать стек оркестрации из развернутых экземпляров ВМ и связанных с ними наборов ресурсов с использованием шаблона и запускать его из каталога с помощью диалогового окна службы.

##### 11.2.3.1 Создание шаблона оркестрации

Для добавления нового шаблона оркестрации нужно выполнить следующие действия:

в меню панели навигации выбрать пункт "Службы → Каталоги";

развернуть аккордеон "Шаблоны оркестрации" и выбрать в меню пункт "Все шаблоны оркестрации" или имя шаблона;

нажать кнопку Конфигурация и выбрать Создать новый шаблон оркестрации;

на экране в рабочей области "Добавление нового шаблона оркестрации" задать значения параметров (рисунок 185):

"Имя" – ввести имя шаблона;

"Описание" – ввести описание шаблона;

"Тип шаблона" – выбрать из раскрывающегося списка тип шаблона;

поставить отметку, если шаблон создается в режиме "Черновик" и не включается в качестве элемента;

"Содержимое" – поставить переключатель на требуемый язык сценария YAML или JSON и ввести код сценария для шаблона;

нажать кнопку Добавить.

Добавление шаблона оркестрации

В зависимости от выбранного типа шаблона вновь созданные шаблоны распределяются по каталогам шаблонов (рисунок 186).

Типы шаблонов оркестрации

Для работы с уже существующими шаблонами оркестрации при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать этот шаблон оркестрации – внести необходимые изменения в параметры шаблона;

Копировать этот шаблон оркестрации – копировать, задав уникальное "Имя" шаблона;

Удалить этот шаблона оркестрации из инвентаря – удалить выбранный шаблон, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

Для редактирования тегов шаблона оркестрации нужно нажать на кнопку Политики и выбрать Редактировать теги; в появившейся рабочей области выбрать из раскрывающихся списков "Категорию" и "Значение" тега; нажать кнопку Сохранить.

##### 11.2.3.2 Создание диалога службы из шаблона оркестрации

Для добавления нового диалога службы из шаблона оркестрации нужно выполнить следующие действия:

в меню панели навигации выбрать пункт "Службы → Каталоги";

развернуть аккордеон "Шаблоны оркестрации" и выбрать в меню имя шаблона;

нажать кнопку Конфигурация и выбрать Создать диалог службы из шаблона оркестрации;

на экране в рабочей области "Добавление нового диалога службы из шаблона оркестрации" задать значения параметров:

"Имя" – ввести имя диалога;

нажать кнопку Сохранить.

#### 11.2.4 Работа с каталогами служб

При выборе в левой панели аккордеона "Каталоги" можно работать непосредственно с каталогами (рисунок 187).

Список каталогов служб

Для добавления нового каталога службы нужно выполнить следующие действия:

в меню панели навигации выбрать пункт "Службы → Каталоги";

развернуть аккордеон "Каталоги" и выбрать в меню "Все каталоги" или пункт с именем каталога;

нажать кнопку Конфигурация и выбрать Добавить новый элемент каталога;

в рабочей области задать параметры (рисунок 188):

"Имя" – наименование каталога;

"Описание" – краткое описание каталога;

"Назначить элементы" – выбрать параметры фильтров из списка "Не назначено" в список "Выбрано" для назначения этому каталогу элементов, используя кнопки Добавить, Добавить все, Удалить, Удалить все.

Добавление нового каталога

Для работы с уже существующими каталогами при нажатии кнопки Конфигурация активируются опции меню, при выборе которых проводятся следующие действия:

Редактировать этот элемент – внести необходимые изменения в параметры каталога;

Удалить каталоги – удалить выбранный каталог, подтвердив действие нажатием кнопки Да в появившемся модальном окне.

### 11.3 Нагрузки

Для управления состоянием, статусом, загруженностью и другими параметрами ВМ и экземпляров в составе служб в Комплексе используется функционал в меню панели навигации "Служба  Нагрузки". В этом же разделе можно редактировать шаблоны и образы ВМ. В левой панели рабочей области отображаются аккордеоны "ВМ и экземпляры", "Шаблоны и образы", которые разворачиваются до общих, встроенных и пользовательских фильтров в иерархическом виде, в правой – списки ВМ, экземпляров, шаблонов и образов или их содержание (рисунок 189).

Список ВМ и экземпляров

#### 0.0.1 ВМ и экземпляры

Для работы с ВМ и экземплярами нужно перейти в меню панели навигации "Служба  Нагрузки", развернуть аккордеон "ВМ и экземпляры", выбрать каталог "Все ВМ и экземпляры", после чего в рабочей области появится список всех ВМ и экземпляров в Комплексе.

##### 11.3.0.1 Обзор

Для выбора из общего списка предусмотрены встроенные "Глобальные фильтры", для перехода к которым нужно развернуть аккордеон "Глобальные фильтры" и выбрать один из фильтров по окружению, статусу или типу создания, при этом в рабочей области отобразятся только ВМ и экземпляры, удовлетворяющие этому фильтру.

При выборе конкретной ВМ или экземпляра в рабочей области появится вся информация о состоянии, распределенная по секциям (рисунок 190):

Свойства – идентификатор, имя, описание, имя хоста, IP-адреса, MAC-адрес, контейнер, платформа родительского хоста, инструменты платформы, операционная система, признак схожести ЦП, устройства, снимки, дополнительные параметры, доступность ресурсов, доступно, GUID подсистемы управления, признак защищённости;

Жизненный цикл – сведения о времени обнаружения, последнего анализа, вывода из эксплуатации; состояние вывода из эксплуатации, группа арендаторов;

Соответствие требованием – статус последней проверки и история проверок;

Управление электропитанием – состояние энергопотребления, время последней загрузки, время изменения состояния;

Безопасность – пользователи и группы пользователей;

Конфигурация – файлы конфигураций;

VMsafe – информация о включении функции, интегрируемой в гипервизор VMware и обеспечивающей прозрачность для предотвращения угроз безопасности на ВМ;

Отношения – тип и описание поставщика, кластер, хост, пул ресурсов, хранилища данных, служба, генеалогия (родительские и дочерние ВМ), история дрейфа, история анализа, события настраиваемой кнопки;

Нормальные рабочие диапазоны (более 30 дней) – данные о нагрузках ЦП (максимум, высокое, в среднем, низкое; в MHz и потребление в %); об использовании памяти (максимум, высокое, в среднем, низкое; в Гбайт и потребление в %);

Сводка выделения ресурсов по хранилищу данных – количество дисков; выровненные диски; использование тонкого резервирования; объем дисков; всего выделено Гбайт;

Сводка фактического потребления по хранилищу данных – объем дисков; размер снимков; общее потребляемое пространство хранилища данных; выделение ресурсов (неиспользуемое/превышенное);

Диагностика – выполняющиеся процессы; журналы событий;

Управление Smart – теги компании.

Секции для улучшения визуального восприятия можно сворачивать и разворачивать.

Данные и значения состояний кликабельны, если выделены синим цветом; по ним можно перейти к подробному просмотру данных и значений. Цифрами рядом со значками обозначаются количества экземпляров информации.

Общие сведения о ВМ

##### 11.3.0.2 Операции

Для работы с ВМ используется меню быстрого доступа нажатием кнопок для выполнения операций (подробное описание см. в п.6.1.4.2).

#### 11.3.1 Шаблоны и образы

Для работы с шаблонами и образами нужно перейти в меню панели навигации "Служба  Нагрузки", развернуть аккордеон "Шаблоны и образы", выбрать каталог "Все шаблоны и образы", после чего в рабочей области появится список всех шаблонов и образов в Комплексе.

##### 11.3.1.1 Обзор

Для выбора из общего списка предусмотрены встроенные "Глобальные фильтры", для перехода к которым нужно развернуть аккордеон "Глобальные фильтры" и выбрать один из фильтров по окружению, статусу или типу создания, при этом в рабочей области отобразятся только шаблоны и образы, удовлетворяющие этому фильтру.

При выборе конкретного шаблона или образа в рабочей области появится вся информация о состоянии, распределенная по секциям (рисунок 191):

Свойства – идентификатор, имя, описание, имя хоста, IP-адреса, MAC-адрес, контейнер, платформа родительского хоста, инструменты платформы, операционная система, признак схожести ЦП, устройства, снимки, дополнительные параметры, доступность ресурсов, доступно, GUID подсистемы управления, признак защищённости;

Жизненный цикл – сведения о времени обнаружения, последнего анализа, вывода из эксплуатации; состояние вывода из эксплуатации, группа арендаторов;

Соответствие требованием – статус последней проверки и история проверок;

Управление электропитанием – состояние энергопотребления, время последней загрузки, время изменения состояния;

Безопасность – пользователи и группы пользователей;

Конфигурация – файлы конфигураций;

VMsafe – информация о включении функции, интегрируемой в гипервизор VMware и обеспечивающей прозрачность для предотвращения угроз безопасности на ВМ;

Отношения – тип и описание поставщика, кластер, хост, пул ресурсов, хранилища данных, служба, генеалогия (родительские и дочерние ВМ), история дрейфа, история анализа, события настраиваемой кнопки;

Нормальные рабочие диапазоны (более 30 дней) – данные о нагрузках ЦП (максимум, высокое, в среднем, низкое; в MHz и потребление в %); об использовании памяти (максимум, высокое, в среднем, низкое; в Гбайт и потребление в %);

Сводка выделения ресурсов по хранилищу данных – количество дисков; выровненные диски; использование тонкого резервирования; объем дисков; всего выделено Гбайт;

Сводка фактического потребления по хранилищу данных – объем дисков; размер снимков; общее потребляемое пространство хранилища данных; выделение ресурсов (неиспользуемое/превышенное);

Диагностика – выполняющиеся процессы; журналы событий;

Управление Smart – теги компании.

Секции для улучшения визуального восприятия можно сворачивать и разворачивать.

Данные и значения состояний кликабельны, если выделены синим цветом; по ним можно перейти к подробному просмотру данных и значений. Цифрами рядом со значками обозначаются количества экземпляров информации.

Общие сведения о шаблоне и образе

##### 11.3.1.2 Операции

Для работы с шаблонами и образами используется меню быстрого доступа для выполнения операций через кнопки:

Конфигурация:

Обновить сведения об отношениях и состоянии электропитания – обновить страницу новыми сведениями об отношениях со связанными ресурсами и состоянии электропитания;

Сравнить выбранные шаблоны – (при выборе не менее двух элементов) провести сравнение шаблонов по характеристикам и заданным параметрам (подробнее см. п.11.3.3);

Редактировать этот шаблон – редактировать параметры шаблона, такие как настраиваемый идентификатор, описание, родительскую ВМ, дочерние ВМ;

Настроить владельца – выбрать пользователя–владельца и группу с соответствующими ролями;

Удалить шаблон из инвентаря – удалить шаблон и всех его компоненты из Комплекса;

Политика:

Управление политиками – назначить шаблону группы политик контроля или соответствия;

Имитация политик – выбрать для шаблона группы политик контроля или соответствия для проверки перед их назначением в рабочей среде (п.7.1.3);

Редактировать теги – выбрать "Категории" и "Значения" для назначения тегов шаблону;

Проверить последнюю известную конфигурацию на соответствие требованиям – проверить конфигурацию шаблона на соответствие требованиям политик;

Жизненный цикл;

Подготовить ресурсы ВМ с использованием этого шаблона – подготовить запрос на предоставление ресурсов ВМ с использованием шаблона (см.п.12.1);

Клонировать этот шаблон – во вкладках настроить параметры нового запроса шаблона на базе клонируемого;

Наблюдение:

Загруженность – просмотр в виде виджетов текущих, исторических и прогнозных данных по мощностям (ЦП, память, дисковый ввод-вывод, сетевой ввод-вывод), загруженности в соответствии с задаваемыми параметрами времени и периодов и в сравнении с родительскими ресурсами (хост, кластер);

Временные шкалы – просмотр временных шкал для заданных типов, категорий и уровней событий, дат начала и окончания.

#### 11.3.2 Сравнение ВМ и шаблонов

Для сравнения ВМ или шаблонов в меню панели навигации требуется выполнить следующие действия:

выбрать "Службы  Нагрузки";

перейти к общему списку в аккордеоне "Все ВМ и экземпляры" или "Шаблоны и образы";

выбрать флажками не менее двух ВМ или шаблонов;

нажать кнопку Конфигурация и выбрать Сравнить выбранные элементы;

в рабочей области появятся панели "Секции сравнения" и "Сравнение ВМ или шаблона" (рисунок 192) для проведения сравнения:

в панели "Секции сравнения" из иерархического списка выбирают флажками характеристики и параметры, которые предполагаются к сравнению, и нажимают кнопку Применить;

в панели "Сравнение ВМ или шаблона" отображаются в табличном виде результаты сравнения: в первой колонке – перечень атрибутов (в круглых скобках – количество соответствий); во второй колонке – базовые ВМ или шаблон (% совпадения); в следующих колонках – результат сравнения с базовыми атрибутами виде круговой диаграммы, при наведении на которые появляется величина процентов совпадения;

в панели быстрого доступа можно изменить представление результатов сравнения нажатием на пиктограммы:

(все атрибуты) – отображение всех атрибутов в панели сравнения;

(атрибуты с разными значениями) – отображение только атрибутов с разными значениями в панели сравнения;

(атрибуты с одинаковыми значениями) – отображение только атрибутов с одинаковыми значениями в панели сравнения;

(режим подробных сведений) – отображение подробных сведений в панели сравнения;

(режим "существования") – отображение сведений только о "существующих" атрибутах в панели сравнения;

(развернутый просмотр) – отображение значений атрибутов в развернутом виде;

(сжатый режим просмотра) – отображение значений атрибутов в виде значков  (совпадение) или (несовпадение), при наведении курсора "мыши" на которые отображается значение атрибута.

Сравнение ВМ или шаблонов

### 11.4 Запросы

Для просмотра, подтверждения или предоставления ВМ или экземпляра в Комплексе используется механизм запросов.

Для обнаружения вновь поступивших запросов необходим выбрать в меню панели навигации "Службы  Запросы" и ввести параметры фильтра для поиска запросов (рисунок 193):

"Инициатор запроса" – выбрать из раскрывающегося списка всех инициаторов запросов или конкретного;

"Состояние одобрения" – указать флажками выбираемые состояния запросов: "Ожидается одобрение", "Одобрено", "Отклонено";

"Тип" – выбрать все запросы или только запросы автоматизации;

"Дата запроса" – выбрать период создания запроса: "Последние 24 часа", "Последние 7 дней" или "последние 30 дней";

"Причина" – ввести поисковую маску из описания причины запроса.

Далее нажать кнопку Применить.

В случае если запросы по фильтру будут обнаружены, они появятся в виде списка ниже, иначе появится сообщение "Записей не найдено".

Для обновления содержания рабочей области в части списка и содержания запросов можно воспользоваться кнопкой Обновить сведения.

Фильтр поиска новых запросов

Для перехода к работе с запросом нужно выбрать строку с нужным именем и в рабочей области отобразится информация о нем и управляющие пиктограммы в панели быстрого доступа (рисунок 194) для дополнительных действий:

– копировать исходный запрос; задать параметры скопированного запроса в части описания и характеристик ВМ;

– удалить этот запрос;

– одобрить этот запрос; при одобрении запроса в ручном режиме можно ввести причину одобрения в соответствующем поле;

– отклонить этот запрос; при отклонении запроса в ручном режиме можно ввести причину отклонения в соответствующем поле.

Информация о запросе