# Общий доступ

Подсистема позволяет делиться панелями мониторинга и графиками с другими пользователями организации, а в некоторых случаях – публично в Интернете. Можно делиться с помощью следующих средств:

- Прямые связи с пользователями в организации и за ее пределами;
- Снимки;
- Встраиваемые элементы;
- PDF-файлы;
- Файлы JSON;
- Отчеты;
- Библиотечные панели.

Также можно пригласить новых участников в свою организацию из меню "Share (Поделиться)".

Чтобы увидеть изображение, отображаемое по прямой ссылке, должно быть разрешение на просмотр. Такое же разрешение требуется для просмотра встроенных ссылок, если только для экземпляра Подсистемы не включено разрешение на анонимный доступ.

Общий доступ к панелям мониторинга предоставляется следующими способами:

- внутренней ссылкой;
- вне организации кому-то;
- в качестве отчета;
- как снимок;
- экспорт в формате PDF;
- экспорт в виде файла JSON.

При предоставлении доступа к панели мониторинга извне в виде ссылки или по электронной почте эти панели мониторинга включаются в список общих панелей мониторинга. Чтобы просмотреть список этих панелей мониторинга и управлять ими, следует перейти в раздел меню "Dashboards (Панели мониторинга)  Public dashboards (Общие панели мониторинга)".

Следует убедиться, что изменения панели мониторинга были сохранены, прежде чем поделиться ими.

Чтобы поделиться прямой ссылкой на панель мониторинга внутри организации, выполняют следующие действия:

1. выбрать "Dashboards (Панели мониторинга)" в главном меню;
2. нажать панель мониторинга, которой требуется поделиться;
3. нажать на значок  "Share (Поделиться)" в верхней панели;
  [Рисунок 501](/image62.png)
4. (необязательно) в открывшемся окне на вкладке "Link (Ссылка)" установить следующие параметры:
  - Lock time range (Диапазон времени блокировки) – изменить текущий относительный диапазон времени на абсолютный; эта опция включена по умолчанию;
  - Shorten link (Краткая ссылка) – сократить ссылку на панель мониторинга; эта опция включена по умолчанию;
  - Theme (Тема) – выбрать тему для панели мониторинга: "Current (Текущая)" , "Dark (Темная)" или "Light (Светлая)";
5. нажать Copy link (Скопировать ссылку);
6. отправить скопированную ссылку пользователю Подсистемы, у которого есть разрешение на просмотр ссылки;
7. нажать  в правом верхнем углу, чтобы закрыть панель общего доступа.
  [Рисунок 502](/image63.png)

После настройки внутренней ссылки, можно быстро поделиться ею, выполнив следующие действия:

1. выбрать "Dashboards (Панели мониторинга)" в главном меню;
2. нажать на панель мониторинга, которой требуется поделиться;
3. чтобы скопировать краткую ссылку, нажать кнопку Share (Поделиться), а не значок выпадающего списка.

Эта ссылка содержит все настройки, например блокировку диапазона времени или тему, которые ранее были установлены и которые хранятся в браузере.

Внешние панели мониторинга позволяют делиться панелью мониторинга Подсистемы с кем угодно. Это полезно, если требуется сделать панель мониторинга доступной для всех, не требуя доступа к организации Подсистемы.

## Общий доступ к панелям мониторинга и панелям

Снимок панели мониторинга позволяет публично поделиться панелью мониторинга, удалив конфиденциальные данные, такие как запросы и ссылки на панели, и оставив только видимые метрики и названия серий. Любой, у кого есть ссылка, может получить доступ к снимку.

Можно публиковать снимки экрана в локальном экземпляре Подсистемы или на сайте snapshots.raintank.io, который позволяет публиковать снимки панели мониторинга. Любой, у кого есть ссылка, может просмотреть их. Также можно установить срок действия, если необходимо, чтобы снимок удалялся через определенный промежуток времени.

Чтобы просмотреть другие снимки, которыми делится организация, следует перейти в "Dashboards (Панели мониторинга)  Snapshots (Снимки)" в главном меню.

Чтобы поделиться своей панелью мониторинга с кем-либо в виде снимка, нужно выполнить следующие действия:

1. выбрать "Dashboards (Панели мониторинга)" в главном меню.
2. нажать панель мониторинга, которой требуется поделиться;
3. нажать на значок  "Share (Поделиться)" в верхней панели и выбрать вкладку "Snapshot (Снимок)";
  [Рисунок 506](/image62.png)
4. на вкладке ввести описательный заголовок для снимка в поле "Snapshot name (Название снимка)";
5. выбрать один из следующих вариантов истечения срока действия снимка:
  - 1 Hour (час);
  - 1 Day (день);
  - 1 Week (Неделя);
  - Never (Никогда);
6. ввести значение в поле "Timeout (Тайм-аут)", чтобы задать метрику снимка;
7. нажать Local snapshot (Локальный снимок) или Publish to snapshots.raintank.io (Опубликовать на snapshots.raintank.io); Подсистема генерирует ссылку на снимок; следует обратить внимание, что нельзя публиковать снимки, содержащие пользовательские панели, на snapshot.raintank.io;
8. нажать "Copy (Копировать)" и поделиться ею либо внутри организации, либо публично в Интернете;
9. нажать  в правом верхнем углу, чтобы закрыть диалоговое окно.
  [Рисунок 507](/image63.png)

Чтобы удалить существующие снимки, выполняют следующие действия:

1. перейти к "Dashboards (Панели мониторинга)  Snapshots (Снимки)" в главном меню;
2. чтобы подтвердить, какой снимок подлежит удалению, нажать "View (Просмотр)" в строке снимка; URL-адреса для снимков панели и панели мониторинга с одной и той же панели мониторинга выглядят похоже, и их предварительный просмотр поможет их различить;
3. нажать на значок  рядом со снимком, который требуется удалить.
  [Рисунок 508](/image10.png)

Снимок немедленно удаляется. Возможно, потребуется очистить кеш браузера или использовать приватный браузер или браузер в режиме инкогнито, чтобы подтвердить это.

## Общий доступ к снимкам

Помимо обмена панелями мониторинга в виде ссылок, отчетов и снимков, можно экспортировать их в формат JSON.

В Подсистеме имеется возможность экспорта панели мониторинга в формате JSON, содержащий все необходимое, включая макет, переменные, стили, источники данных, запросы и т. д., чтобы впоследствии можно было импортировать панель мониторинга. Чтобы экспортировать в файл JSON, выполняют следующие действия:

1. выбрать "Dashboards (Панели мониторинга)" в главном меню;
2. открыть панель мониторинга, которую требуется экспортировать;
3. нажать на значок ;
  [Рисунок 510](/image62.png)
4. в открывшемся окне перейти на вкладку "Export (Экспорт)";
5. при необходимости включить переключатель "Export for sharing externally (Экспорт для внешнего доступа)";
6. можно предварительно просмотреть код JSON по кнопке View JSON (Просмотр JSON);
7. выбрать Save to file (Сохранить в файл)"; сохранение произойдет по правилам браузера;
8. нажать  в правом верхнем углу, чтобы закрыть диалоговое окно.
  [Рисунок 534](/image63.png)

## Экспорт панелей мониторинга

В Подсистеме можно предоставить общий доступ к панелям следующими способами:

- в качестве внутренней ссылки;
- как встроенный элемент;
- как снимок.

Чтобы поделиться внутри организации прямой ссылкой на свою панель, нужно выполнить следующие действия:

1. нажать на значок  в правом верхнем углу панели, которой требуется поделиться;
  [Рисунок 559](/image64.png)
2. из меню действий выбрать "Share (Поделиться)";
3. в открывшемся окне "Share panel (Поделиться панелью)" перейти на вкладку "Link (Ссылка)" и установить следующие параметры:
  - Lock time range (Диапазон времени блокировки) – изменить текущий относительный диапазон времени на абсолютный; эта опция включена по умолчанию;
  - Shorten link (Короткая ссылка) – сократить ссылку на панель; эта опция по умолчанию отключена;
  - Theme (Тема) – выбрать тему для панели мониторинга: "Current (Текущая)" , "Dark (Темная)" или "Light (Светлая)";
4. нажать Copy (Копировать);
5. отправить скопированную ссылку пользователю Подсистемы с разрешением на ее просмотр;
6. (необязательно) чтобы сгенерировать изображение панели в формате PNG, настроить параметры изображения:
  - Width (Ширина) – в пикселях; значение по умолчанию – 1000;
  - Height (Высота) – в пикселях; значение по умолчанию – 500;
  - Scale factor (Коэффициент масштабирования) – значение по умолчанию равно 1.

> Примечание – В конфигурации средства визуализации изображений есть максимальные значения для ширины, высоты и коэффициента масштабирования, которые при необходимости можно изменить.

1. (необязательно) нажать Generate image (Генерировать изображение), чтобы увидеть предварительный просмотр изображения панели;
2. (необязательно) нажать Download image (Загрузить изображение);
3. отправить скопированное изображение пользователю Подсистемы с разрешением на его просмотр;
4. нажать  в правом верхнем углу, чтобы закрыть панель общего доступа.
  [Рисунок 564](/image63.png)

При нажатии кнопки Generate image (Генерировать изображение) в настройках панели Подсистема генерирует изображение панели в формате PNG на стороне сервера со параметрами по умолчанию, приведенными в таблице 42:

1. Параметры изображения по умолчанию

| **Параметр** | **Описание** |
| --- | --- |
| width | Ширина в пикселях. Значение по умолчанию равно 1000 |
| height | Высота в пикселях. Значение по умолчанию равно 500 |
| tz | Часовой пояс в формате UTC%2BHH%3AMM, где HH и MM – смещение в часах и минутах после UTC |
| timeout | Количество секунд. Тайм-аут можно увеличить, если запрос для панели занимает больше 30 секунд по умолчанию |
| scale | Числовое значение для настройки коэффициента масштабирования устройства. Значение по умолчанию – 1. Можно использовать более высокое значение для получения более детализированных изображений (с более высоким разрешением) |

Также можно обновить эти параметры в конфигурации рендеринга изображения.

Можно поделиться панелью, встроив ее на другой сайт с помощью элемента iframe. Для просмотра панели пользователи должны быть авторизованы в Подсистеме, если только для экземпляра Подсистемы не включено разрешение на анонимный доступ.

Чтобы создать панель, которую можно встроить, выполняют следующие действия:

1. нажать на значок  в правом верхнем углу панели, которой требуется поделиться;
  [Рисунок 565](/image64.png)
2. из меню действий выбрать "Share (Поделиться)";
3. в открывшемся окне "Share panel (Поделиться панелью)" перейти на вкладку "Embed (Вставка)";
4. (необязательно) переключить опцию "Current time range (Текущий диапазон времени)", чтобы задать, будет ли панель использовать текущий относительный диапазон времени или абсолютный диапазон времени; эта опция включена по умолчанию;
5. выбрать тему для панели мониторинга: "Current (Текущая)", "Dark (Темная)" или "Light (Светлая)";
6. (необязательно) внести любые необходимые изменения в HTML-код;
7. нажать Copy to clipboard (Скопировать в буфер обмена);
8. вставить HTML-код в код веб-сайта;
9. нажать  в правом верхнем углу, чтобы закрыть диалоговое окно.
  [Рисунок 571](/image63.png)

Пример того, как может выглядеть HTML-код:

```bash Terminal
<iframe
src="https://snapshots.raintank.io/dashboard-solo/snapshot/y7zwi2bZ7FcoTlB93WN7yWO4aMiz3pZb?from=1493369923321&to=1493377123321&panelId=4"
width="650"
height="300"
frameborder="0"
></iframe>
```

Результатом является интерактивная визуализация Подсистемы, встроенная в элемент iframe HTML-страницы.

## Общий доступ к панелям

Внешние панели мониторинга позволяют делиться панелью мониторинга Подсистемы с кем угодно. Это полезно, если требуется сделать панель мониторинга доступной для всех, не требуя доступа к организации Подсистемы.

Следует убедиться, что после изменения панель мониторинга сохранена, прежде чем поделиться ею.

Следует обратить внимание, что предоставление доступа к своей панели мониторинга извне может привести к большому количеству запросов к источникам данных, используемым панелью мониторинга. Эту проблему можно решить с помощью кеширования и/или функций ограничения скорости.

## Общий доступ для внешних панелей мониторинга

В Подсистеме можно просмотреть список всех внешних панелей мониторинга в одном месте, перейдя к "Dashboards (Панели мониторинга)  Public dashboards (Публичные панели мониторинга)". Для каждой панели мониторинга в списке на странице отображается:

- значок  для просмотра общедоступной версии панели мониторинга;
  [Рисунок 577](/image65.png)
- значок  на общую конфигурацию доступа к панели мониторинга;
  [Рисунок 578](/image26.png)
- переключатель для приостановки доступа к внешней панели мониторинга;
- значок  для отмены доступа к внешней панели мониторинга.
  [Рисунок 579](/image22.png)

Также можно нажать на название панели мониторинга, чтобы перейти на нее.

Важные замечания по предоставлению общего доступа к панели мониторинга извне:

- любой, у кого есть URL-адрес, может получить доступ к панели мониторинга;
- внешние панели мониторинга доступны только для чтения;
- произвольные запросы не могут выполняться к источникам данных через панели мониторинга, доступные извне; панели мониторинга, доступные извне, могут выполнять только запросы, сохраненные на исходной панели мониторинга.

### Список общих панелей мониторинга

Панели мониторинга, доступные извне, должны работать с любым источником данных, в котором свойства backend и alerting имеют значение true в plugin.json. Однако это не всегда возможно, поскольку разработчики плагинов могут переопределить эту функцию. В следующих списках указаны источники данных, которые, как подтверждено, работают с панелями мониторинга, доступными извне, а также источники данных, которые должны работать, но не были подтверждены как совместимые.

Подтвержденные:

- ClickHouse;
- CloudWatch;
- Elasticsearch;
- Infinity;
- InfluxDB;
- Loki;
- Microsoft SQL Server;
- MongoDB;
- MySQL;
- Oracle Database;
- PostgreSQL;
- Prometheus;
- Redis;
- SQLite.

Неподдерживаемые:

- DynamoDB;
- Dynatrace;
- Graphite;
- Google Sheets.

Неподтвержденные:

- Altinity plugin for ClickHouse;
- Amazon Athena;
- Amazon Redshift;
- Amazon Timestream;
- Apache Cassandra;
- AppDynamics;
- Azure Data Explorer Datasource;
- Azure Monitor;
- CSV;
- DB2 Datasource;
- Databricks;
- Datadog;
- Dataset;
- Druid;
- GitHub;
- Google BigQuery;
- Grafana for YNAB;
- Honeycomb;
- Jira;
- Mock;
- Neo4j Datasource;
- New Relic;
- OPC UA (Unified Architecture);
- Open Distro for Elasticsearch;
- OpenSearch;
- OpenTSDB;
- Orbit;
- SAP HANA®;
- Salesforce;
- Sentry;
- ServiceNow;
- Snowflake;
- Splunk;
- Splunk Infrastructure Monitoring;
- Sqlyze data source;
- TDengine;
- Vertica;
- Wavefront;
- X-Ray;
- kdb+;
- simple grpc data source.

### Поддерживаемые источники данных

Необходимо учитывать следующие ограничения для внешних панелей:

- Панели, использующие внешние источники данных, не смогут извлекать данные.
- Переменные и запросы, включающие переменные, не поддерживаются.
- Поддерживаются только аннотации, которые запрашивают источник данных -- Grafana --.
- Примечания к организации не поддерживаются.
- Прямые события Подсистемы и трансляции в режиме реального времени не поддерживаются.
- Панели библиотек не поддерживаются.
- Источники данных, использующие функцию обратного прокси-сервера, не поддерживаются.

### Ограничения