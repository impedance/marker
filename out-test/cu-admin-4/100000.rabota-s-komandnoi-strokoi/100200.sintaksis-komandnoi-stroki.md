# Синтаксис командной строки

Командная строка позволяет устанавливать, обновлять и управлять плагинами Подсистемы.

Все перечисленные команды применяются к репозиториям и каталогам Подсистемы по умолчанию. Возможно изменить настройки по умолчанию с помощью глобальных параметров.

Список доступных плагинов:

```bash Terminal
grafana cli plugins list-remote
```

Установка последней версии плагина:

```bash Terminal
grafana cli plugins install <plugin-id>
```

Установка определенной версии плагина:

```bash Terminal
grafana cli plugins install <plugin-id> <version>
```

Список установленных плагинов:

```bash Terminal
grafana cli plugins ls
```

Обновление всех установленных плагинов:

```bash Terminal
grafana cli plugins update-all
```

Обновление одного плагина:

```bash Terminal
grafana cli plugins update <plugin-id>
```

Удаление одного плагина:

```bash Terminal
grafana cli plugins remove <plugin-id>
```

## Глобальные параметры

Чтобы показать все команды администратора, выполняют:

```bash Terminal
grafana cli admin
```

Сброс пароля администратора

Команда:

```bash Terminal
grafana cli admin reset-admin-password <new password>
```

сбрасывает пароль пользователя-администратора с помощью интерфейса командной строки. Это может понадобиться, если потерян пароль администратора. По умолчанию эта команда использует идентификатор пользователя-администратора по умолчанию, который равен 1. Если известен идентификатор пользователя-администратора, можно использовать флаг --user-id для указания идентификатора пользователя. Если флаг --user-id не указан, и команда не может найти пользователя-администратора, она возвращает список текущих пользователей-администраторов с именами и идентификаторами. Из этого списка можно определить идентификатор пользователя-администратора и снова запустить команду с флагом --user-id.

Если для установки пути к домашнему каталогу и пути к файлу конфигурации используются два флага, то при выполнении команды возникает следующая ошибка:

```bash Terminal
Could not find config defaults, make sure homepath command line parameter is set or working directory is homepath
```

Чтобы исправить это, следует использовать глобальную опцию --homepath для указания пути по умолчанию для Подсистемы для этой команды:

```bash Terminal
grafana cli --homepath "/usr/share/grafana" admin reset-admin-password <new password>
```

Если пароль администратора не потерян, рекомендуется изменить пароль пользователя либо в настройках пользователя, либо в основного меню "Administration (Администрирование)  Users and access (Пользователи и доступ)  Users (Пользователь)".

Если нужно установить пароль в скрипте, можно использовать User API.

Сброс пароля администратора

Если Подсистема установлена с помощью Homebrew, можно сбросить пароль администратора с помощью следующей команды:

```bash Terminal
/opt/homebrew/opt/grafana/bin/grafana cli --config /opt/homebrew/etc/grafana/grafana.ini --homepath /opt/homebrew/opt/grafana/share/grafana --configOverrides cfg:default.paths.data=/opt/homebrew/var/lib/grafana admin reset-admin-password <new password>
```

Перенос данных и шифрование паролей

data-migration запускает скрипт, который переносит или очищает данные в базе данных.

encrypt-datasource-passwords переносит пароли из незащищенных полей в поле secure_json_data и возвращает ok при отсутствии ошибок. Можно выполнять несколько раз:

```bash Terminal
grafana cli admin data-migration encrypt-datasource-passwords
```