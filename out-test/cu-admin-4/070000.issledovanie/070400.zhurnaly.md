# Журналы

## Объем журналов

С помощью навигации по журналам, расположенной справа от строк журнала, можно легко запросить дополнительные журналы, нажав "Older logs (Старые журналы)" в нижней части навигации. Это особенно полезно, когда достигнут предел количества строк и требуется увидеть больше журналов. Каждый запрос, выполненный с помощью навигации, отображается в навигации как отдельная страница. На каждой странице отображаются временные метки from и to входящих строк журнала. Возможно просмотреть предыдущие результаты, нажав на каждую страницу. Рекомендуется исследовать кеши последних пяти запросов, выполненных в разделе "Журналы", чтобы не выполнять одни и те же запросы повторно при переходе по страницам, экономя время и ресурсы (рисунок 61).

::sign-image
---
src: /image105.png
sign: Журналы
---
::

## Журналы

В Подсистеме имеется возможность настроить отображение журналов и выбрать, какие столбцы отображать. В таблице 59 приведен список доступных опций.

1. Параметры визуализации

| **Параметр** | **Описание** |
| --- | --- |
| Time (Время) | Отображает или скрывает столбец времени. Это отметка времени, связанная с записью журнала, полученная из источника данных |
| Unique labels (Уникальные этикетки) | Показывает или скрывает столбец уникальных меток, в котором отображаются только редкие метки. Все распространенные метки отображаются выше |
| Wrap lines (Перенос линий) | Задает значение true для отображения с переносом строк. Если задать значение false, это приведет к горизонтальной прокрутке |
| Prettify JSON (Улучшить JSON) | Задает значение true для улучшенной печати всех журналов в формате JSON. Этот параметр не влияет на журналы в других форматах, кроме JSON |
| Deduplication (Дедупликация) | Данные журнала могут быть часто повторяющимися. "Explore (Исследование)" скрывает повторяющиеся строки журнала, используя несколько различных алгоритмов дедупликации. "Exact (Точное)" совпадение выполняется для всей строки, кроме полей даты. "Numbers (Числовое)" совпадение выполняется для строки после удаления чисел, таких как продолжительность, IP-адреса и т. д. "Signature (Сигнатура)" – это наиболее агрессивный алгоритм дедупликации, который удаляет все буквы и цифры и выполняет сопоставление по оставшимся пробелам и знакам препинания |
| Display results order (Порядок отображения результатов) | Изменяет порядок получения журналов с порядка по умолчанию (сначала новые) на порядок по возрастанию (сначала старые) |

### Навигация по журналам

Эта функция позволяет сохранять данные журнала для дальнейшего анализа или делиться ими с другими пользователями в удобном и доступном формате.

В "Explore (Исследование)" есть три варианта экспорта:

- TXT – экспортирует данные в том виде, в котором они отображаются на экране, то есть с учетом форматирования, например line_format;
- JSON – экспортирует необработанные данные независимо от форматирования, например line_format;
- CSV – экспортирует необработанные данные независимо от форматирования, например line_format.

Необходимо нажать Download (Загрузить) и выбрать TXT, JSON или CSV, чтобы загрузить результаты журнала.

### Параметры визуализации

Следующая метаинформация отображается над извлеченными строками журнала:

- Number of received logs (Количество полученных журналов) – указывает общее количество журналов, полученных за текущий запрос или диапазон времени;
- Error (Ошибка) – отображает все ошибки в результатах журнала;
- Common labels (Общие метки) – отображает общие метки;
- Total bytes processed (Общее количество обработанных байт) – представляет собой совокупный размер обработанных данных журнала в байтах.

> Примечание – Доступность определенных метаданных может различаться в зависимости от источника данных, поэтому можно видеть только сведения, относящиеся к этим конкретным источникам данных.

### Строки журнала загрузки

"Explore (Исследование)" автоматически распознает некоторые неправильно экранированные последовательности в строках журнала, такие как символы новой строки (\n, \r) или табуляции (\t). При обнаружении таких последовательностей появляется опция "Escape newlines (Экранирование символов новой строки)".

Для автоматического исправления неправильно экранированных последовательностей, обнаруженных "Explore (Исследование)", нужно:

1. нажать "Escape newlines (Экранирование символов новой строки)", чтобы заменить последовательности;
2. просмотреть возвращенные строки журнала.

"Explore (Исследование)" заменяет эти последовательности, изменив параметр "Escape newlines (Экранирование символов новой строки)" на "Remove escaping (Удаление экранирования)". Рекомендуется проверить изменения, так как синтаксический анализ может быть неточным в зависимости от ввода. Чтобы отменить замены, следует нажать Remove escaping (Удаление экранирования).

### Метаинформация о результатах журналирования

Для журналов, в которых указана метка level, значение этой метки используется для определения уровня журнала и соответствующего изменения цвета каждой строки журнала. Если в журнале не указана метка уровня, Подсистема пытается определить, соответствует ли его содержимое какому-либо из поддерживаемых выражений. Уровень журнала всегда определяется по первому совпадению. Если Подсистема не может определить поле уровня журнала, оно отображается как неизвестный уровень журнала.

> Примечание – При использовании источника данных Loki, если level является частью строки журнала, можно использовать такие анализаторы, как json, logfmt или regex для извлечения информации об уровне в метку уровня. Эта метка используется для определения значения уровня, что позволяет отображать различные уровни журнала в виде отдельных столбцов на гистограмме.

Поддерживаемые уровни журнала и отображение сокращений и выражений уровня журнала приведены в таблице 60.

1. Уровни журнала

| **Уровень журнала** | **Цвет** | **Поддерживаемые выражения** |
| --- | --- | --- |
| critical(критический) | фиолетовый | emerg, fatal, alert, crit, critical, 0, 1, 2 |
| error (ошибка) | красный | err, eror, error, 3 |
| warning (предупреждение) | желтый | warn, warning, 4 |
| info (информация) | зеленый | info, information, informational, notice, 5, 6 |
| debug (отладка) | синий | dbug, debug, 7 |
| trace (трассировка) | светло-голубой | trace |
| unknown (неизвестный) | серый | * |

### Экранирование новых строк

Если запрос содержит конкретные слова или выражения для поиска по ключевым словам, функция "Explore (Исследование)" выделяет их в строках журнала для повышения наглядности. Эта функция выделения упрощает идентификацию и позволяет сосредоточиться на релевантном содержимом в журналах.

> Примечание – Возможность выделять ключевые слова зависит от источника данных. В некоторых источниках данных выделение ключевых слов может быть недоступно.

### Уровень журнала

В разделе "Explore (Исследование)" каждая строка журнала имеет расширяемый раздел под названием "Log details (Сведения о журнале)", который открывается при нажатии на строку журнала. В этом разделе представлена дополнительная информация и параметры исследования в виде "Fields (Полей)" и "Links (Ссылки)", прикрепленных к строкам журнала, что обеспечивает более эффективное взаимодействие и анализ.

В представлении "Log details (Сведения о журнале)" можно отфильтровать отображаемые поля двумя способами: с помощью положительного фильтра, который фокусируется на конкретном поле, и с помощью отрицательного фильтра, который исключает определенные поля. Эти фильтры изменяют соответствующий запрос, на основе которого была сформирована строка журнала, соответствующим образом добавляя выражения равенства и неравенства.

Если источник данных поддерживает эту функцию, как в случае с Loki и Elasticsearch, сведения о журнале проверят, включено ли поле в текущий запрос, и укажут активное состояние для положительных фильтров. Это позволит при необходимости отключить его в запросе или преобразовать выражение фильтра из положительного в отрицательное.

Чтобы выбрать подмножество полей для отображения в списке журналов вместо полной строки журнала нужно нажать на значок .

::sign-image
---
src: /image106.png
sign: Рисунок 467
---
::

В каждом поле есть значок статистики, который отображает специальную статистику по всем отображаемым журналам.

Подсистема предоставляет ссылки на данные или корреляции, позволяющие преобразовать любую часть сообщения журнала в внутреннюю или внешнюю ссылку. Эти ссылки позволяют переходить к связанным данным или внешним ресурсам, обеспечивая удобный способ поиска дополнительной информации (рисунок 62).

::sign-image
---
src: /image107.png
sign: Ссылки на данные
---
::

### Выделение искомых слов

Контекст журнала – это функция, которая отображает дополнительные строки контекста вокруг записи журнала, соответствующей определенному поисковому запросу. Это помогает понять контекст записи журнала и аналогично параметру "-C" в команде grep.

Следует включить "Wrap lines (перенос строк)", если приходится иметь дело с длинными строками текста, которые затрудняют чтение и анализ контекста вокруг записей в журнале. При включении этой функции Подсистема автоматически переносит длинные строки текста в пределах видимой ширины окна просмотра, что упрощает чтение и понимание записей в журнале.

Чтобы выполнить контекстный запрос для записи журнала в разделенном виде в режиме "Explore (Исследование)" нужно нажать Open in split view (Открыть в разделенном виде). При нажатии на эту кнопку открывается новая панель "Explore (Исследование)" с контекстным запросом, отображаемым рядом с записью журнала, что упрощает анализ и понимание контекста.

Чтобы открыть контекстный запрос журнала в новом браузере и просмотреть контекстную модель необходимо нажать и удерживать клавишу Ctrl/Cmd. Все ранее выбранные фильтры в результате будут применены.

Чтобы скопировать содержимое выбранной строки журнала в буфер обмена нажимают Copy log line (Копировать строку журнала).

С помощью связывания строк журнала в Подсистеме можно быстро переходить к конкретным записям журнала для подробного и точного анализа. Для этого нажимают Copy shortlink (Копировать краткую ссылку), чтобы создать и скопировать короткий URL-адрес, который обеспечивает прямой доступ к конкретной записи журнала в абсолютном временном диапазоне. При открытии ссылки Подсистема автоматически переходит к соответствующей строке журнала и выделяет ее синим цветом, что позволяет легко найти и сосредоточиться на нужной информации.

> Примечание – Функция сокращения URL-адресов в настоящее время поддерживается только в Loki и других источниках данных, которые предоставляют поле id.

### Просмотр сведений о журнале

Функция "Live tail (Просмотр в реальном времени)" используется для просмотра журналов в реальном времени из источников данных. Для этого выполняют следующие действия:

- нажать кнопку Live (Реальное время) в панели инструментов, чтобы перейти к просмотру в режиме реального времени;
- в режиме "Live tail view (Просмотр в реальном времени)" новые записи отображаются в нижней части экрана на контрастном фоне, что позволяет легко отслеживать изменения;
- нажать Pause (Пауза), чтобы приостановить отслеживание в реальном времени и просмотреть предыдущие журналы без перерывов или просто пролистать журналы;
- нажать Clear logs (Очистить журналы), чтобы удалить все отображаемые журналы; это действие сбрасывает настройки журнала и позволяет начать анализ журнала с "чистого листа";
- нажать Resume (Возобновить), чтобы возобновить отслеживание в реальном времени и продолжить просмотр журналов в реальном времени;
- нажать Stop (Стоп), чтобы выйти из режима просмотра в реальном времени и вернуться к стандартному режиму просмотра.

Функция "Live tail (Просмотр в реальном времени)" позволяет отслеживать последние записи журналов в режиме реального времени, что упрощает отслеживание событий по мере их возникновения и позволяет оперативно выявлять проблемы.

Если выбранный источник данных поддерживает выборки журналов и запросы как к журналам, так и к метрикам, автоматически появятся выборки строк журналов, которые влияют на визуализируемые метрики для запросов к метрикам. Следует обратить внимание, что в настоящее время эта функция поддерживается только источником данных Loki.

При переходе от источника данных о метриках, реализующего DataSourceWithQueryExportSupport (например, Prometheus), к источнику данных о журналах, поддерживающему DataSourceWithQueryImportSupport (например, Loki), "Explore (Исследование)" сохраняет метки из запроса, которые существуют в журналах, и использует их для запроса потоков журналов.

### Контекст журнала

Функцию "Explore (Исследование)" можно использовать для запроса и визуализации трассировок из источников данных о трассировках. Поддерживаемые источники данных:

- Tempo;
- Jaeger;
- Zipkin;
- X-Ray;
- Azure Monitor;
- ClickHouse;
- New Relic;
- Infinity.

Возможно запрашивать и искать данные трассировки с помощью редактора запросов источника данных.

## Просмотр в реальном времени

В представлении трассировки отображается обзор запроса по мере его прохождения через Подсистему (рисунок 63).

::sign-image
---
src: /image108.png
sign: Просмотр трассировки
---
::

Заголовок представления трассировки включает в себя следующее (рисунок 64):

- Header title (Заголовок) – показывает название корневого диапазона и идентификатор трассировки;
- Search (Поиск) – выделяет области, содержащие искомый текст;
- Metadata (Метаданные) – различные метаданные о трассировке.

::sign-image
---
src: /image109.png
sign: Заголовок представления трассировки
---
::

Мини-карта отображает сокращенное представление временной шкалы. Можно переместить курсор "мыши" на мини-карту, чтобы уменьшить масштаб до меньшего временного диапазона. Это также обновляет основную временную шкалу, облегчая просмотр более коротких промежутков времени (рисунок 65). При уменьшении масштаба при наведении курсора на мини-карту отображается опция "Reset selection (Сброс выделения)", которая сбрасывает масштаб.

::sign-image
---
src: /image110.png
sign: Заголовок представления трассировки
---
::

1. Пример миникарты для просмотра трассировки

На временной шкале отображается список диапазонов в пределах трассировки. Каждый диапазон состоит из следующих компонентов:

- Expand children (Развернуть дочерние элементы) – расширяет или сворачивает все дочерние элементы выбранного элемента;
- Service name (Название службы) – название службы, зарегистрировавшей интервал;
- Operation name (Название операции) – название операции, которую представляет этот интервал;
- Span duration bar (Диапазон продолжительности выполнения) – визуальное представление продолжительности выполнения операции в пределах трассировки.

Можно нажать в любом месте диапазона, чтобы просмотреть подробные сведения о ней (рисунок 66).

::sign-image
---
src: /image111.png
sign: Временная шкала просмотра трассировки
---
::

Трассировки состоят из одного или нескольких диапазонов. Диапазон – это единица работы в рамках трассировки, которая имеет время начала относительно начала трассировки, продолжительность и имя операции для единицы работы. Обычно он содержит ссылку на родительский диапазон, если только это не первый или корневой диапазон в трассировке. Он часто включает атрибуты "ключ-значение", относящиеся к самому промежутку, например метод HTTP, используемый в запросе, а также другие метаданные, такие как название сервиса, события вложенных промежутков или ссылки на другие промежутки.

Возможно развернуть любой диапазон в трассировке и просмотреть подробности, включая диапазоны и атрибуты ресурсов.

Подробная информация о диапазоне включает:

- Span attributes (Атрибуты диапазона) – пары "ключ-значение", которые предоставляют контекст для диапазонов. Например, если диапазон связан с вызовом другой службы по протоколу HTTP, атрибут может включать URL-адрес HTTP (возможно, в качестве ключа атрибута диапазона http.url) и возвращаемый код состояния HTTP (в качестве атрибута диапазона http.status_code);
- Resource attributes (Атрибуты ресурса) – пары "ключ-значение", описывающие контекст сбора данных.

Возможно обратиться к атрибутам диапазона и ресурса для получения более подробной информации (рисунок 67).

::sign-image
---
src: /image112.png
sign: Сведения о диапазоне просмотра трассировки
---
::

Фильтры диапазонов позволяют уточнить диапазоны, отображаемые в окне просмотра временной шкалы трассировки. Чем больше фильтров добавляется, тем более конкретными становятся отфильтрованные диапазоны. Чтобы получить доступ к фильтрам диапазонов, следует нажать на трассировку (рисунок 68).

::sign-image
---
src: /image113.png
sign: Сведения о диапазоне просмотра трассировки
---
::

1. Фильтры диапазонов

Возможно добавить один или несколько из следующих фильтров:

- Service name (Название службы) – по названию службы из выпадающего списка;
- Span name (Название диапазона) – по названию диапазона из выпадающего списка;
- Duration (Продолжительность) – по продолжительности; допустимые единицы измерения: ns, us, ms, s, m, h;
- Tags (Теги) –по тегам, процессам или полям журнала в диапазоне.

Чтобы показывать только те интервалы, которые сопоставили, нужно включить переключатель "Show matches only (Показывать только совпадения)".

Возможно перейти от диапазона в представлении трассировки непосредственно к журналам, относящимся к этому диапазону. Эта функция доступна для источников данных Tempo, Jaeger и Zipkin.

Чтобы открыть разделенное представление в "Explore (Исследование)" с настроенным источником данных и запросить соответствующие журналы для диапазона нужно нажать на значок документа (рисунок 69).

::sign-image
---
src: /image114.png
sign: Трассировка по журналам
---
::

Возможно перейти от диапазона в представлении трассировки непосредственно к метрикам, относящимся к этому диапазону. Эта функция доступна для источников данных Tempo, Jaeger и Zipkin.

С помощью функции трассировки по профилям можно использовать способность Подсистемы сопоставлять различные сигналы, добавив функцию связи между трассировками и профилями (рисунок 70).

::sign-image
---
src: /image115.png
sign: Трассировка по журналам
---
::

1. Трассировка по профилям